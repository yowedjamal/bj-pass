{"version":3,"file":"bj-pass-auth-widget.min.js","mappings":"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","sources":["webpack://BjPassAuthWidget/webpack/universalModuleDefinition","webpack://BjPassAuthWidget/./src/bj-pass-auth-widget.js","webpack://BjPassAuthWidget/webpack/bootstrap","webpack://BjPassAuthWidget/webpack/runtime/amd options","webpack://BjPassAuthWidget/webpack/runtime/harmony module decorator","webpack://BjPassAuthWidget/webpack/startup"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"BjPassAuthWidget\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"BjPassAuthWidget\"] = factory();\n\telse\n\t\troot[\"BjPassAuthWidget\"] = factory();\n})(window, function() {\nreturn ","/**\r\n * bj-pass Authentication Widget\r\n * Widget d'authentification OAuth 2.0/OpenID Connect moderne et sécurisé\r\n * @version 1.0.0\r\n * @author yowedjamal\r\n * @license MIT\r\n */\r\n\r\n// =======================\r\n// Configuration Manager\r\n// =======================\r\nclass ConfigManager {\r\n  constructor(userConfig = {}) {\r\n    this.environments = {\r\n      test: {\r\n        baseUrl: \"https://test-tx-pki.gouv.bj\",\r\n        defaultAuthServer: \"main-as\",\r\n      },\r\n      production: {\r\n        baseUrl: \"https://tx-pki.gouv.bj\",\r\n        defaultAuthServer: \"main-as\",\r\n      },\r\n    };\r\n\r\n    this.defaultConfig = {\r\n      environment: \"test\",\r\n      clientId: \"\",\r\n      authServer: \"\",\r\n      scope: \"openid profile\",\r\n      redirectUri: \"http://127.0.0.1:5500/examples/redirect.html\",\r\n      // redirectUri: \"https://bj-pass.vercel.app/redirect.html\",\r\n      pkce: true,\r\n      verifyAccessToken: false,\r\n      tokenVerificationScopes: [\"urn:safelayer:eidas:oauth:token:introspect\"],\r\n      beUrl: \"\",\r\n      beBearer: \"\",\r\n      header: {},\r\n      ui: {\r\n        showEnvSelector: true,\r\n        container: \"#bjpass-auth-container\",\r\n        language: \"fr\",\r\n        primaryColor: \"#0066cc\",\r\n        theme: \"default\",\r\n      },\r\n\r\n      // NOUVELLES OPTIONS BACKEND\r\n      backendUrl: \"https://your-backend.com\", // URL de votre backend Laravel\r\n      backendEndpoints: {\r\n        start: \"/auth/start\", // Endpoint de démarrage\r\n        status: \"/auth/api/status\", // Vérification du statut\r\n        user: \"/auth/api/user\", // Informations utilisateur\r\n        logout: \"/auth/api/logout\", // Déconnexion\r\n        refresh: \"/auth/api/refresh\", // Rafraîchissement token\r\n      },\r\n\r\n      // Configuration de sécurité\r\n      frontendOrigin: \"https://your-frontend.com\", // Origine autorisée\r\n      backendOrigin: \"https://your-backend.com\", // Origine du backend\r\n\r\n      // Options de communication\r\n      useBackend: true, // Activer l'utilisation du backend\r\n      popupMode: true, // Mode popup recommandé\r\n      autoClosePopup: true, // Fermeture automatique après succès\r\n    };\r\n\r\n    this.config = { ...this.defaultConfig, ...userConfig };\r\n    this.resolvedConfig = this.applyEnvironmentConfig();\r\n  }\r\n\r\n  applyEnvironmentConfig() {\r\n    const env = this.config.environment || \"test\";\r\n    const envConfig = this.environments[env] || this.environments.test;\r\n\r\n    return {\r\n      ...this.config,\r\n      baseUrl: envConfig.baseUrl,\r\n      authServer: this.config.authServer || envConfig.defaultAuthServer,\r\n    };\r\n  }\r\n\r\n  updateConfig(newConfig) {\r\n    this.config = { ...this.config, ...newConfig };\r\n    this.resolvedConfig = this.applyEnvironmentConfig();\r\n  }\r\n\r\n  get() {\r\n    return this.resolvedConfig;\r\n  }\r\n\r\n  getEnvironments() {\r\n    return Object.keys(this.environments);\r\n  }\r\n}\r\n\r\n// =======================\r\n// Crypto Utils\r\n// =======================\r\nclass CryptoUtils {\r\n  static generateRandomString(length) {\r\n    const array = new Uint8Array(length);\r\n    window.crypto.getRandomValues(array);\r\n    return Array.from(array, (b) => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n  }\r\n\r\n  static async generateCodeChallenge(codeVerifier) {\r\n    const encoder = new TextEncoder();\r\n    const data = encoder.encode(codeVerifier);\r\n    const digest = await window.crypto.subtle.digest(\"SHA-256\", data);\r\n\r\n    return btoa(String.fromCharCode(...new Uint8Array(digest)))\r\n      .replace(/\\+/g, \"-\")\r\n      .replace(/\\//g, \"_\")\r\n      .replace(/=+$/, \"\");\r\n  }\r\n\r\n  static base64UrlToArrayBuffer(base64Url) {\r\n    const padding = \"=\".repeat((4 - (base64Url.length % 4)) % 4);\r\n    const base64 = base64Url.replace(/-/g, \"+\").replace(/_/g, \"/\") + padding;\r\n    const rawData = atob(base64);\r\n    const output = new Uint8Array(rawData.length);\r\n\r\n    for (let i = 0; i < rawData.length; ++i) {\r\n      output[i] = rawData.charCodeAt(i);\r\n    }\r\n    return output;\r\n  }\r\n\r\n  static checkBrowserCompatibility() {\r\n    return !!(window.crypto && window.crypto.subtle);\r\n  }\r\n}\r\n\r\n// =======================\r\n// Session Manager\r\n// =======================\r\nclass SessionManager {\r\n  static setItem(key, value) {\r\n    sessionStorage.setItem(`tx_auth_${key}`, value);\r\n  }\r\n\r\n  static getItem(key) {\r\n    return sessionStorage.getItem(`tx_auth_${key}`);\r\n  }\r\n\r\n  static removeItem(key) {\r\n    sessionStorage.removeItem(`tx_auth_${key}`);\r\n  }\r\n\r\n  static clear() {\r\n    const keys = [\"state\", \"code_verifier\", \"nonce\", \"success\"];\r\n    keys.forEach((key) => this.removeItem(key));\r\n  }\r\n\r\n  static generateAndStoreAuthData(scope) {\r\n    const state = CryptoUtils.generateRandomString(32);\r\n    const nonce = CryptoUtils.generateRandomString(32);\r\n    const codeVerifier = CryptoUtils.generateRandomString(64);\r\n\r\n    this.setItem(\"state\", state);\r\n    this.setItem(\"code_verifier\", codeVerifier);\r\n\r\n    if (scope.includes(\"openid\")) {\r\n      this.setItem(\"nonce\", nonce);\r\n    }\r\n\r\n    return { state, nonce, codeVerifier };\r\n  }\r\n}\r\n\r\n// =======================\r\n// OAuth URL Builder\r\n// =======================\r\nclass OAuthUrlBuilder {\r\n  constructor(config) {\r\n    this.config = config;\r\n  }\r\n\r\n  async buildAuthorizationUrl(authData) {\r\n    const { state, nonce, codeVerifier } = authData;\r\n    const codeChallenge = await CryptoUtils.generateCodeChallenge(codeVerifier);\r\n\r\n    const authUrl = new URL(`${this.config.baseUrl}/trustedx-authserver/oauth`);\r\n\r\n    if (this.config.authServer) {\r\n      authUrl.pathname += `/${encodeURIComponent(this.config.authServer)}`;\r\n    }\r\n\r\n    const params = new URLSearchParams({\r\n      response_type: \"code\",\r\n      client_id: this.config.clientId,\r\n      redirect_uri: this.config.redirectUri,\r\n      scope: this.config.scope.split(\"+\").join(\" \"),\r\n      state,\r\n      code_challenge: codeChallenge,\r\n      code_challenge_method: \"S256\",\r\n      prompt: \"login\",\r\n    });\r\n\r\n    if (this.config.scope.includes(\"openid\") && nonce) {\r\n      params.set(\"nonce\", nonce);\r\n    }\r\n\r\n    authUrl.search = params.toString();\r\n    return authUrl.toString();\r\n  }\r\n\r\n  buildTokenUrl() {\r\n    return `${this.config.baseUrl}/trustedx-authserver/oauth/${encodeURIComponent(\r\n      this.config.authServer\r\n    )}/token`;\r\n  }\r\n\r\n  buildJWKSUrl() {\r\n    return `${this.config.baseUrl}/trustedx-authserver/oauth/keys`;\r\n  }\r\n\r\n  buildIntrospectionUrl() {\r\n    return `${this.config.baseUrl}/trustedx-authserver/oauth/token/verify`;\r\n  }\r\n}\r\n\r\n// =======================\r\n// Token Validator\r\n// =======================\r\nclass TokenValidator {\r\n  constructor(config, urlBuilder) {\r\n    this.config = config;\r\n    this.urlBuilder = urlBuilder;\r\n  }\r\n\r\n  async validateIdToken(idToken) {\r\n    try {\r\n      const [header, payload] = idToken.split(\".\");\r\n      const decodedHeader = JSON.parse(atob(header));\r\n      const decodedPayload = JSON.parse(atob(payload));\r\n\r\n      // Basic validations\r\n      const now = Math.floor(Date.now() / 1000);\r\n      const savedNonce = SessionManager.getItem(\"nonce\");\r\n\r\n      if (decodedPayload.exp < now) {\r\n        throw new Error(\"Token expired\");\r\n      }\r\n\r\n      if (decodedPayload.nonce !== savedNonce) {\r\n        throw new Error(\"Invalid nonce\");\r\n      }\r\n\r\n      if (decodedPayload.aud !== this.config.clientId) {\r\n        throw new Error(\"Invalid audience\");\r\n      }\r\n\r\n      // Signature validation\r\n      const jwks = await this.fetchJWKS();\r\n      const publicKey = jwks.keys.find((key) => key.kid === decodedHeader.kid);\r\n\r\n      if (!publicKey) {\r\n        throw new Error(\"No matching public key found\");\r\n      }\r\n\r\n      const isValid = await this.verifySignature(idToken, publicKey);\r\n      if (!isValid) {\r\n        throw new Error(\"Invalid signature\");\r\n      }\r\n\r\n      return decodedPayload;\r\n    } catch (error) {\r\n      console.error(\"ID Token validation failed:\", error);\r\n      throw new Error(\"Invalid ID Token\");\r\n    }\r\n  }\r\n\r\n  async verifyAccessToken(accessToken) {\r\n    try {\r\n      const response = await fetch(this.urlBuilder.buildIntrospectionUrl(), {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/x-www-form-urlencoded\",\r\n          Authorization: `Bearer ${accessToken}`,\r\n        },\r\n        body: new URLSearchParams({ token: accessToken }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (!response.ok || !data.active) {\r\n        throw new Error(\"Token verification failed\");\r\n      }\r\n\r\n      return data;\r\n    } catch (error) {\r\n      console.error(\"Token verification error:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async fetchJWKS() {\r\n    const response = await fetch(this.urlBuilder.buildJWKSUrl());\r\n    if (!response.ok) {\r\n      throw new Error(\"Failed to fetch JWKS\");\r\n    }\r\n    return await response.json();\r\n  }\r\n\r\n  async verifySignature(token, jwk) {\r\n    try {\r\n      const key = await window.crypto.subtle.importKey(\r\n        \"jwk\",\r\n        jwk,\r\n        { name: \"RSASSA-PKCS1-v1_5\", hash: { name: \"SHA-256\" } },\r\n        false,\r\n        [\"verify\"]\r\n      );\r\n\r\n      const [header, payload, signature] = token.split(\".\");\r\n      const signatureData = CryptoUtils.base64UrlToArrayBuffer(signature);\r\n      const data = new TextEncoder().encode(`${header}.${payload}`);\r\n\r\n      return await window.crypto.subtle.verify(\r\n        \"RSASSA-PKCS1-v1_5\",\r\n        key,\r\n        signatureData,\r\n        data\r\n      );\r\n    } catch (error) {\r\n      console.error(\"Signature verification error:\", error);\r\n      return false;\r\n    }\r\n  }\r\n}\r\n\r\n// =======================\r\n// UI Component Base Class\r\n// =======================\r\nclass UIComponent {\r\n  constructor(container) {\r\n    this.container = container;\r\n    this.element = null;\r\n    this.eventListeners = new Map();\r\n  }\r\n\r\n  createElement(tag, className = \"\", innerHTML = \"\") {\r\n    const element = document.createElement(tag);\r\n    if (className) element.className = className;\r\n    if (innerHTML) element.innerHTML = innerHTML;\r\n    return element;\r\n  }\r\n\r\n  addEventListeners(element, events) {\r\n    Object.entries(events).forEach(([event, handler]) => {\r\n      element.addEventListener(event, handler);\r\n\r\n      // Store for cleanup\r\n      if (!this.eventListeners.has(element)) {\r\n        this.eventListeners.set(element, []);\r\n      }\r\n      this.eventListeners.get(element).push({ event, handler });\r\n    });\r\n  }\r\n\r\n  removeEventListeners() {\r\n    this.eventListeners.forEach((listeners, element) => {\r\n      listeners.forEach(({ event, handler }) => {\r\n        element.removeEventListener(event, handler);\r\n      });\r\n    });\r\n    this.eventListeners.clear();\r\n  }\r\n\r\n  destroy() {\r\n    this.removeEventListeners();\r\n    if (this.element && this.element.parentNode) {\r\n      this.element.parentNode.removeChild(this.element);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    throw new Error(\"render() must be implemented by subclass\");\r\n  }\r\n\r\n  show() {\r\n    if (this.element) this.element.style.display = \"block\";\r\n  }\r\n\r\n  hide() {\r\n    if (this.element) this.element.style.display = \"none\";\r\n  }\r\n}\r\n\r\n// =======================\r\n// UI Components\r\n// =======================\r\nclass EnvironmentSelector extends UIComponent {\r\n  constructor(container, config, onEnvironmentChange) {\r\n    super(container);\r\n    this.config = config;\r\n    this.onEnvironmentChange = onEnvironmentChange;\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    if (!this.config.ui.showEnvSelector) return;\r\n\r\n    const envOptions = this.config\r\n      .getEnvironments()\r\n      .map(\r\n        (env) => `\r\n        <label>\r\n          <input type=\"radio\" name=\"env\" value=\"${env}\" ${env === this.config.get().environment ? \"checked\" : \"\"}>\r\n          ${env.charAt(0).toUpperCase() + env.slice(1)}\r\n        </label>\r\n      `\r\n      )\r\n      .join(\"\");\r\n\r\n    this.element = this.createElement(\r\n      \"div\",\r\n      \"bjpass-env-selector\",\r\n      `\r\n      <div class=\"env-selector-label\">Environment:</div>\r\n      ${envOptions}\r\n    `\r\n    );\r\n\r\n    const radioInputs = this.element.querySelectorAll('input[name=\"env\"]');\r\n    radioInputs.forEach((radio) => {\r\n      this.addEventListeners(radio, {\r\n        change: (e) => this.onEnvironmentChange(e.target.value),\r\n      });\r\n    });\r\n\r\n    this.container.appendChild(this.element);\r\n  }\r\n}\r\n\r\nclass LoginButton extends UIComponent {\r\n  constructor(container, config, onLogin) {\r\n    super(container);\r\n    this.config = config;\r\n    this.onLogin = onLogin;\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    this.element = this.createElement(\r\n      \"button\",\r\n      \"bjpass-login-btn\",\r\n      \"Se connecter\"\r\n    );\r\n    this.element.type = \"button\";\r\n    this.element.style.cssText = `\r\n      width: 100%;\r\n      padding: 12px 24px;\r\n      background-color: ${this.config.ui.primaryColor};\r\n      color: white;\r\n      border: none;\r\n      border-radius: 6px;\r\n      font-size: 16px;\r\n      cursor: pointer;\r\n      transition: background-color 0.2s;\r\n    `;\r\n\r\n    this.addEventListeners(this.element, {\r\n      click: this.onLogin,\r\n      mouseover: () => {\r\n        this.element.style.opacity = \"0.9\";\r\n      },\r\n      mouseout: () => {\r\n        this.element.style.opacity = \"1\";\r\n      },\r\n    });\r\n\r\n    this.container.appendChild(this.element);\r\n  }\r\n\r\n  setLoading(isLoading) {\r\n    this.element.disabled = isLoading;\r\n    this.element.innerHTML = isLoading ? \"Connexion...\" : \"Se connecter\";\r\n  }\r\n}\r\n\r\nclass LoadingSpinner extends UIComponent {\r\n  constructor(container) {\r\n    super(container);\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    this.element = this.createElement(\r\n      \"div\",\r\n      \"bjpass-loading\",\r\n      `\r\n      <div class=\"spinner\"></div>\r\n      <div class=\"loading-text\">Authentification en cours...</div>\r\n    `\r\n    );\r\n\r\n    this.element.style.cssText = `\r\n      display: none;\r\n      text-align: center;\r\n      padding: 20px;\r\n    `;\r\n\r\n    const spinner = this.element.querySelector(\".spinner\");\r\n    spinner.style.cssText = `\r\n      border: 3px solid #f3f3f3;\r\n      border-radius: 50%;\r\n      border-top: 3px solid #0066cc;\r\n      width: 30px;\r\n      height: 30px;\r\n      animation: spin 1s linear infinite;\r\n      margin: 0 auto 10px;\r\n    `;\r\n\r\n    // Add CSS animation\r\n    if (!document.getElementById(\"bjpass-spinner-styles\")) {\r\n      const style = document.createElement(\"style\");\r\n      style.id = \"bjpass-spinner-styles\";\r\n      style.textContent = `\r\n        @keyframes spin {\r\n          0% { transform: rotate(0deg); }\r\n          100% { transform: rotate(360deg); }\r\n        }\r\n      `;\r\n      document.head.appendChild(style);\r\n    }\r\n\r\n    this.container.appendChild(this.element);\r\n  }\r\n}\r\n\r\nclass ErrorDisplay extends UIComponent {\r\n  constructor(container, config) {\r\n    super(container);\r\n    this.config = config;\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    this.element = this.createElement(\"div\", \"bjpass-error\");\r\n    this.element.style.cssText = `\r\n      display: none;\r\n      padding: 12px;\r\n      margin: 10px 0;\r\n      background-color: #fee;\r\n      border: 1px solid #fcc;\r\n      border-radius: 4px;\r\n      color: #c33;\r\n      font-size: 14px;\r\n    `;\r\n\r\n    this.container.appendChild(this.element);\r\n  }\r\n\r\n  showError(message) {\r\n    this.element.textContent = message;\r\n    this.show();\r\n  }\r\n\r\n  clearError() {\r\n    this.element.textContent = \"\";\r\n    this.hide();\r\n  }\r\n}\r\n\r\n// =======================\r\n// UI Manager\r\n// =======================\r\nclass UIManager {\r\n  constructor(config) {\r\n    this.config = config;\r\n    this.container = null;\r\n    this.components = {};\r\n    this.state = {\r\n      isLoading: false,\r\n      error: null,\r\n    };\r\n  }\r\n\r\n  initialize() {\r\n    this.container = document.querySelector(this.config.ui.container);\r\n    if (!this.container) {\r\n      throw new Error(`Container ${this.config.ui.container} not found`);\r\n    }\r\n\r\n    this.createMainContainer();\r\n    this.initializeComponents();\r\n  }\r\n\r\n  createMainContainer() {\r\n    this.mainElement = document.createElement(\"div\");\r\n    this.mainElement.className = \"bjpass-widget\";\r\n    this.mainElement.style.cssText = `\r\n      max-width: 400px;\r\n      margin: 0 auto;\r\n      padding: 20px;\r\n      border: 1px solid #ddd;\r\n      border-radius: 8px;\r\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n    `;\r\n\r\n    const title = document.createElement(\"h3\");\r\n    title.textContent = \"Authentification BjPass\";\r\n    title.style.cssText = `\r\n      color: ${this.config.ui.primaryColor};\r\n      text-align: center;\r\n      margin: 0 0 20px 0;\r\n    `;\r\n\r\n    this.mainElement.appendChild(title);\r\n    this.container.appendChild(this.mainElement);\r\n  }\r\n\r\n  initializeComponents() {\r\n    // Environment selector\r\n    this.components.envSelector = new EnvironmentSelector(\r\n      this.mainElement,\r\n      this.config,\r\n      this.onEnvironmentChange.bind(this)\r\n    );\r\n\r\n    // Login button\r\n    this.components.loginButton = new LoginButton(\r\n      this.mainElement,\r\n      this.config,\r\n      this.onLoginClick.bind(this)\r\n    );\r\n\r\n    // Loading spinner\r\n    this.components.loadingSpinner = new LoadingSpinner(this.mainElement);\r\n\r\n    // Error display\r\n    this.components.errorDisplay = new ErrorDisplay(\r\n      this.mainElement,\r\n      this.config\r\n    );\r\n\r\n    // Help text\r\n    const helpText = document.createElement(\"p\");\r\n    helpText.textContent =\r\n      \"Vous serez redirigé vers le service d'authentification sécurisée\";\r\n    helpText.style.cssText = `\r\n      text-align: center;\r\n      margin: 15px 0 0 0;\r\n      font-size: 0.9em;\r\n      color: #666;\r\n    `;\r\n    this.mainElement.appendChild(helpText);\r\n  }\r\n\r\n  onEnvironmentChange(environment) {\r\n    if (this.onEnvironmentChangeCallback) {\r\n      this.onEnvironmentChangeCallback(environment);\r\n    }\r\n  }\r\n\r\n  onLoginClick() {\r\n    if (this.onLoginCallback) {\r\n      this.onLoginCallback();\r\n    }\r\n  }\r\n\r\n  setState(newState) {\r\n    this.state = { ...this.state, ...newState };\r\n    this.updateUI();\r\n  }\r\n\r\n  updateUI() {\r\n    if (this.state.isLoading) {\r\n      this.components.loginButton.setLoading(true);\r\n      this.components.loadingSpinner.show();\r\n      this.components.errorDisplay.clearError();\r\n    } else {\r\n      this.components.loginButton.setLoading(false);\r\n      this.components.loadingSpinner.hide();\r\n\r\n      if (this.state.error) {\r\n        this.components.errorDisplay.showError(this.state.error);\r\n      } else {\r\n        this.components.errorDisplay.clearError();\r\n      }\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    Object.values(this.components).forEach((component) => {\r\n      if (component.destroy) component.destroy();\r\n    });\r\n\r\n    if (this.mainElement && this.mainElement.parentNode) {\r\n      this.mainElement.parentNode.removeChild(this.mainElement);\r\n    }\r\n  }\r\n\r\n  // Event handler setters\r\n  setOnEnvironmentChange(callback) {\r\n    this.onEnvironmentChangeCallback = callback;\r\n  }\r\n\r\n  setOnLogin(callback) {\r\n    this.onLoginCallback = callback;\r\n  }\r\n}\r\n\r\n// =======================\r\n// Backend Client\r\n// =======================\r\nclass BackendClient {\r\n  constructor(config) {\r\n    this.config = config;\r\n  }\r\n\r\n  async exchangeCode(code, state) {\r\n    const response = await fetch(this.config.beUrl, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        ...this.config.header,\r\n      },\r\n      body: JSON.stringify({\r\n        code,\r\n        state,\r\n        redirect_uri: this.config.redirectUri,\r\n        code_verifier: SessionManager.getItem(\"code_verifier\"),\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorData = await response.json();\r\n      throw new Error(errorData.message || \"Échec de l'authentification\");\r\n    }\r\n\r\n    return await response.json();\r\n  }\r\n\r\n  async exchangeCodeDirect(code, state, urlBuilder) {\r\n    const codeVerifier = SessionManager.getItem(\"code_verifier\");\r\n    if (!codeVerifier) {\r\n      throw new Error(\"Missing code verifier\");\r\n    }\r\n\r\n    const response = await fetch(urlBuilder.buildTokenUrl(), {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\r\n      },\r\n      body: new URLSearchParams({\r\n        grant_type: \"authorization_code\",\r\n        code,\r\n        redirect_uri: this.config.redirectUri,\r\n        client_id: this.config.clientId,\r\n        code_verifier: codeVerifier,\r\n      }),\r\n    });\r\n\r\n    const data = await response.json();\r\n\r\n    if (!response.ok) {\r\n      throw new Error(data.error_description || \"Failed to obtain token\");\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  async handleBackendAuthResponse(data) {\r\n    try {\r\n      if (data.status === \"success\") {\r\n        // Authentification réussie\r\n        await this.handleBackendAuthSuccess(data);\r\n      } else {\r\n        // Erreur d'authentification\r\n        this.handleBackendAuthError(data);\r\n      }\r\n    } catch (error) {\r\n      this.handleError(\"callback_error\", error.message);\r\n    }\r\n  }\r\n\r\n  async handleBackendAuthSuccess(data) {\r\n    try {\r\n      // Stocker les informations utilisateur\r\n      SessionManager.setItem(\"user\", JSON.stringify(data.user));\r\n      SessionManager.setItem(\"success\", \"true\");\r\n\r\n      // Fermer la popup\r\n      this.popupManager.close();\r\n\r\n      // Mettre à jour l'UI\r\n      this.uiManager.setState({ isLoading: false, error: null });\r\n\r\n      // Appeler le callback de succès\r\n      const config = this.configManager.get();\r\n      if (config.onSuccess) {\r\n        config.onSuccess({\r\n          user: data.user,\r\n          backendData: data,\r\n          source: \"backend\",\r\n        });\r\n      }\r\n\r\n      // Vérifier le statut via l'API backend\r\n      await this.verifyBackendStatus();\r\n    } catch (error) {\r\n      this.handleError(\"success_verification_error\", error.message);\r\n    }\r\n  }\r\n\r\n  handleBackendAuthError(data) {\r\n    // Fermer la popup\r\n    this.popupManager.close();\r\n\r\n    // Afficher l'erreur\r\n    this.handleError(\r\n      data.error || \"backend_error\",\r\n      data.message || \"Erreur d'authentification\"\r\n    );\r\n\r\n    // Appeler le callback d'erreur\r\n    const config = this.configManager.get();\r\n    if (config.onError) {\r\n      config.onError({\r\n        error: data.error,\r\n        error_description: data.message,\r\n        source: \"backend\",\r\n      });\r\n    }\r\n  }\r\n\r\n  async verifyBackendStatus() {\r\n    try {\r\n      const config = this.configManager.get();\r\n      const statusUrl = new URL(\r\n        config.backendEndpoints.status,\r\n        config.backendUrl\r\n      );\r\n\r\n      const response = await fetch(statusUrl.toString(), {\r\n        method: \"GET\",\r\n        credentials: \"include\", // Inclure les cookies de session\r\n        headers: {\r\n          Accept: \"application/json\",\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Status check failed: ${response.status}`);\r\n      }\r\n\r\n      const statusData = await response.json();\r\n\r\n      if (statusData.authenticated) {\r\n        // Mettre à jour les informations utilisateur\r\n        SessionManager.setItem(\"user\", JSON.stringify(statusData.user));\r\n        SessionManager.setItem(\"authenticated\", \"true\");\r\n\r\n        console.log(\"Backend status verified:\", statusData);\r\n      } else {\r\n        // L'utilisateur n'est pas authentifié côté backend\r\n        SessionManager.clear();\r\n        throw new Error(\"User not authenticated on backend\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Backend status verification failed:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async startBackendAuthFlow() {\r\n    const config = this.configManager.get();\r\n\r\n    if (!config.backendUrl) {\r\n      throw new Error(\"Backend URL not configured\");\r\n    }\r\n\r\n    // Construire l'URL de démarrage du backend\r\n    const startUrl = new URL(config.backendEndpoints.start, config.backendUrl);\r\n\r\n    // Ajouter des paramètres optionnels\r\n    if (config.returnUrl) {\r\n      startUrl.searchParams.set(\"return_url\", config.returnUrl);\r\n    }\r\n\r\n    // Ouvrir la popup vers le backend\r\n    this.popupManager.open(startUrl.toString(), () => {\r\n      this.uiManager.setState({ isLoading: false });\r\n      if (!SessionManager.getItem(\"success\")) {\r\n        this.handleError(\r\n          \"popup_closed\",\r\n          \"La fenêtre d'authentification a été fermée\"\r\n        );\r\n      }\r\n    });\r\n  }\r\n\r\n  async getUserInfoFromBackend() {\r\n    const config = this.configManager.get();\r\n    const userUrl = new URL(config.backendEndpoints.user, config.backendUrl);\r\n\r\n    const response = await fetch(userUrl.toString(), {\r\n      method: \"GET\",\r\n      credentials: \"include\",\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`User info request failed: ${response.status}`);\r\n    }\r\n\r\n    const userData = await response.json();\r\n    return userData.user;\r\n  }\r\n\r\n  async logoutFromBackend() {\r\n    const config = this.configManager.get();\r\n    const logoutUrl = new URL(\r\n      config.backendEndpoints.logout,\r\n      config.backendUrl\r\n    );\r\n\r\n    const response = await fetch(logoutUrl.toString(), {\r\n      method: \"POST\",\r\n      credentials: \"include\",\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`Backend logout failed: ${response.status}`);\r\n    }\r\n\r\n    console.log(\"Backend logout successful\");\r\n  }\r\n}\r\n\r\n// =======================\r\n// Popup Manager\r\n// =======================\r\nclass PopupManager {\r\n  constructor() {\r\n    this.popup = null;\r\n    this.checkInterval = null;\r\n  }\r\n\r\n  open(url, onClose) {\r\n    const width = 500;\r\n    const height = 600;\r\n    const left = (screen.width - width) / 2;\r\n    const top = (screen.height - height) / 2;\r\n\r\n    this.popup = window.open(\r\n      url,\r\n      \"BjPassAuth\",\r\n      `width=${width},height=${height},top=${top},left=${left},resizable=yes,scrollbars=yes`\r\n    );\r\n\r\n    // Check if popup is closed\r\n    this.checkInterval = setInterval(() => {\r\n      if (this.popup && this.popup.closed) {\r\n        this.close();\r\n        if (onClose) onClose();\r\n      }\r\n    }, 500);\r\n  }\r\n\r\n  close() {\r\n    if (this.checkInterval) {\r\n      clearInterval(this.checkInterval);\r\n      this.checkInterval = null;\r\n    }\r\n\r\n    if (this.popup && !this.popup.closed) {\r\n      this.popup.close();\r\n    }\r\n\r\n    this.popup = null;\r\n  }\r\n\r\n  isOpen() {\r\n    return this.popup && !this.popup.closed;\r\n  }\r\n}\r\n\r\n// =======================\r\n// Error Handler\r\n// =======================\r\nclass ErrorHandler {\r\n  static getErrorMessage(error, description) {\r\n    let errorMessage = \"Erreur d'authentification\";\r\n\r\n    const errorMessages = {\r\n      invalid_token: \"Token invalide ou expiré\",\r\n      unsuported_grant_type_error: \"Type de subvention OAuth invalide\",\r\n      insufficient_scope: \"Permissions insuffisantes\",\r\n      invalid_grant: \"Code d'autorisation invalide ou expiré\",\r\n      access_denied: \"Authentification annulée\",\r\n      invalid_request: \"Requête invalide\",\r\n      invalid_scope: \"Permissions invalides\",\r\n      server_error: \"Erreur du serveur\",\r\n      popup_closed: \"La fenêtre d'authentification a été fermée\",\r\n      browser_error: \"Navigateur non supporté\",\r\n      backend_error: \"Erreur du backend\",\r\n      token_error: \"Erreur de validation du token\",\r\n      token_exchange_error: \"Erreur lors de l'échange\",\r\n    };\r\n\r\n    if (errorMessages[error]) {\r\n      errorMessage = errorMessages[error];\r\n    }\r\n\r\n    if (description) {\r\n      errorMessage += `: ${description}`;\r\n    }\r\n\r\n    return errorMessage;\r\n  }\r\n}\r\n\r\n// =======================\r\n// Main Widget Class\r\n// =======================\r\nclass BjPassAuthWidget {\r\n  constructor(config = {}) {\r\n    // Initialize modules\r\n    this.configManager = new ConfigManager(config);\r\n    this.uiManager = new UIManager(this.configManager.get());\r\n    this.urlBuilder = new OAuthUrlBuilder(this.configManager.get());\r\n    this.tokenValidator = new TokenValidator(\r\n      this.configManager.get(),\r\n      this.urlBuilder\r\n    );\r\n    this.backendClient = new BackendClient(this.configManager.get());\r\n    this.popupManager = new PopupManager();\r\n\r\n    // Check browser compatibility\r\n    if (!CryptoUtils.checkBrowserCompatibility()) {\r\n      throw new Error(\"Browser not supported. Please use a modern browser.\");\r\n    }\r\n\r\n    // Initialize UI\r\n    this.initialize();\r\n\r\n    // Setup global message listener\r\n    this.setupMessageListener();\r\n  }\r\n\r\n  initialize() {\r\n    this.uiManager.initialize();\r\n    this.setupEventHandlers();\r\n  }\r\n\r\n  setupEventHandlers() {\r\n    this.uiManager.setOnEnvironmentChange((environment) => {\r\n      this.configManager.updateConfig({ environment });\r\n      this.urlBuilder = new OAuthUrlBuilder(this.configManager.get());\r\n      this.tokenValidator = new TokenValidator(\r\n        this.configManager.get(),\r\n        this.urlBuilder\r\n      );\r\n      this.backendClient = new BackendClient(this.configManager.get());\r\n    });\r\n\r\n    this.uiManager.setOnLogin(() => {\r\n      this.startAuthFlow();\r\n    });\r\n  }\r\n\r\n  // setupMessageListener() {\r\n  //   window.addEventListener(\"message\", (event) => {\r\n  //     if (event.data.type === \"bjpass-auth-response\") {\r\n  //       this.handlePopupResponse(event.data.query);\r\n  //     }\r\n  //   });\r\n  // }\r\n\r\n  setupMessageListener() {\r\n    window.addEventListener(\"message\", (event) => {\r\n      // Vérifier l'origine du message\r\n      if (!this.isValidMessageOrigin(event.origin)) {\r\n        console.warn(\"Message from unauthorized origin:\", event.origin);\r\n        return;\r\n      }\r\n\r\n      // Vérifier le type de message\r\n      if (event.data && event.data.type === \"bjpass-auth-response\") {\r\n        this.backendClient.handleBackendAuthResponse(event.data);\r\n      }\r\n    });\r\n  }\r\n\r\n  isValidMessageOrigin(origin) {\r\n    const config = this.configManager.get();\r\n    const allowedOrigins = [config.backendOrigin, config.frontendOrigin];\r\n\r\n    // Permettre l'origine exacte ou wildcard\r\n    return allowedOrigins.some(\r\n      (allowed) => allowed === \"*\" || allowed === origin\r\n    );\r\n  }\r\n\r\n  // async startAuthFlow() {\r\n  //   try {\r\n  //     this.uiManager.setState({ isLoading: true, error: null });\r\n\r\n  //     const config = this.configManager.get();\r\n  //     const authData = SessionManager.generateAndStoreAuthData(config.scope);\r\n  //     const authUrl = await this.urlBuilder.buildAuthorizationUrl(authData);\r\n\r\n  //     console.log(\"Authorization URL:\", authUrl);\r\n\r\n  //     this.popupManager.open(authUrl, () => {\r\n  //       this.uiManager.setState({ isLoading: false });\r\n  //       if (!SessionManager.getItem(\"success\")) {\r\n  //         this.handleError(\r\n  //           \"popup_closed\",\r\n  //           \"La fenêtre d'authentification a été fermée\"\r\n  //         );\r\n  //       }\r\n  //     });\r\n  //   } catch (error) {\r\n  //     this.handleError(\"auth_flow_error\", error.message);\r\n  //   }\r\n  // }\r\n\r\n  async startAuthFlow() {\r\n    try {\r\n    const config = this.configManager.get();\r\n\r\n      this.uiManager.setState({ isLoading: true, error: null });\r\n\r\n      if (config.useBackend) {\r\n        // Utiliser le backend pour l'authentification\r\n        await this.backendClient.startBackendAuthFlow();\r\n      } else {\r\n        // Fallback vers l'ancienne méthode\r\n        await this.startDirectAuthFlow();\r\n      }\r\n    } catch (error) {\r\n      this.handleError(\"auth_flow_error\", error.message);\r\n    }\r\n  }\r\n\r\n  async startDirectAuthFlow() {\r\n    // Ancienne logique existante...\r\n    const config = this.configManager.get();\r\n    const authData = SessionManager.generateAndStoreAuthData(config.scope);\r\n    const authUrl = await this.urlBuilder.buildAuthorizationUrl(authData);\r\n\r\n    this.popupManager.open(authUrl, () => {\r\n      this.uiManager.setState({ isLoading: false });\r\n      if (!SessionManager.getItem(\"success\")) {\r\n        this.handleError(\r\n          \"popup_closed\",\r\n          \"La fenêtre d'authentification a été fermée\"\r\n        );\r\n      }\r\n    });\r\n  }\r\n\r\n  async handlePopupResponse(queryParams) {\r\n    try {\r\n      const params = new URLSearchParams(queryParams);\r\n      const code = params.get(\"code\");\r\n      const state = params.get(\"state\");\r\n      const error = params.get(\"error\");\r\n\r\n      if (error) {\r\n        this.handleError(error, params.get(\"error_description\"));\r\n        return;\r\n      }\r\n\r\n      if (!code || !state) {\r\n        this.handleError(\"invalid_response\", \"Code ou state manquant\");\r\n        return;\r\n      }\r\n\r\n      // Validate state\r\n      const savedState = SessionManager.getItem(\"state\");\r\n      if (state !== savedState) {\r\n        this.handleError(\"invalid_state\", \"Paramètre state invalide\");\r\n        return;\r\n      }\r\n\r\n      SessionManager.setItem(\"success\", \"true\");\r\n      this.popupManager.close();\r\n\r\n      // Exchange code for tokens\r\n      await this.exchangeCodeForTokens(code, state);\r\n    } catch (error) {\r\n      this.handleError(\"callback_error\", error.message);\r\n    }\r\n  }\r\n\r\n  async exchangeCodeForTokens(code, state) {\r\n    try {\r\n      const config = this.configManager.get();\r\n      let tokenData;\r\n\r\n      // Use backend or direct exchange based on configuration\r\n      if (config.beUrl) {\r\n        tokenData = await this.backendClient.exchangeCode(code, state);\r\n      } else {\r\n        this.handleError(\r\n          \"unsuported_grant_type_error\",\r\n          \"Type de subvention OAuth non encore pris en charge.\"\r\n        );\r\n        return;\r\n      }\r\n\r\n      // Validate tokens\r\n      await this.validateTokens(tokenData.data);\r\n\r\n      // Success\r\n      SessionManager.clear();\r\n      this.uiManager.setState({ isLoading: false, error: null });\r\n\r\n      if (config.onSuccess) {\r\n        config.onSuccess(tokenData);\r\n      }\r\n    } catch (error) {\r\n      this.handleError(\"token_exchange_error\", error.message);\r\n    }\r\n  }\r\n\r\n  async validateTokens(tokenData) {\r\n    const config = this.configManager.get();\r\n\r\n    // Validate ID token if present\r\n    if (tokenData.id_token && config.scope.includes(\"openid\")) {\r\n      await this.tokenValidator.validateIdToken(tokenData.id_token);\r\n    }\r\n\r\n    // Verify access token if requested\r\n    if (config.verifyAccessToken && tokenData.access_token) {\r\n      await this.tokenValidator.verifyAccessToken(tokenData.access_token);\r\n    }\r\n  }\r\n\r\n  handleError(errorCode, description) {\r\n    console.error(\"Auth error:\", errorCode, description);\r\n\r\n    const errorMessage = ErrorHandler.getErrorMessage(errorCode, description);\r\n\r\n    this.uiManager.setState({\r\n      isLoading: false,\r\n      error: errorMessage,\r\n    });\r\n\r\n    const config = this.configManager.get();\r\n    if (config.onError) {\r\n      config.onError({ error: errorCode, error_description: description });\r\n    }\r\n  }\r\n\r\n  async getUserInfo() {\r\n    const config = this.configManager.get();\r\n\r\n    if (config.useBackend) {\r\n      try {\r\n        // Essayer de récupérer depuis le backend\r\n        return await this.backendClient.getUserInfoFromBackend();\r\n      } catch (error) {\r\n        console.warn(\r\n          \"Failed to get user info from backend, falling back to session:\",\r\n          error\r\n        );\r\n      }\r\n    }\r\n\r\n    // Fallback vers la session locale\r\n    const userData = SessionManager.getItem(\"user\");\r\n    return userData ? JSON.parse(userData) : null;\r\n  }\r\n\r\n  async logout() {\r\n    const config = this.configManager.get();\r\n\r\n    if (config.useBackend) {\r\n      try {\r\n        await this.backendClient.logoutFromBackend();\r\n      } catch (error) {\r\n        console.warn(\"Backend logout failed:\", error);\r\n      }\r\n    }\r\n\r\n    // Nettoyer la session locale\r\n    SessionManager.clear();\r\n\r\n    // Mettre à jour l'UI\r\n    this.uiManager.setState({ isLoading: false, error: null });\r\n\r\n    // Appeler le callback de déconnexion\r\n    if (config.onLogout) {\r\n      config.onLogout();\r\n    }\r\n  }\r\n\r\n  async refreshToken() {\r\n    const config = this.configManager.get();\r\n\r\n    if (!config.useBackend) {\r\n      throw new Error(\"Token refresh not supported in direct mode\");\r\n    }\r\n\r\n    try {\r\n      const refreshUrl = new URL(\r\n        config.backendEndpoints.refresh,\r\n        config.backendUrl\r\n      );\r\n\r\n      const response = await fetch(refreshUrl.toString(), {\r\n        method: \"POST\",\r\n        credentials: \"include\",\r\n        headers: {\r\n          Accept: \"application/json\",\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Token refresh failed: ${response.status}`);\r\n      }\r\n\r\n      const refreshData = await response.json();\r\n      console.log(\"Token refreshed successfully\");\r\n\r\n      return refreshData.token_info;\r\n    } catch (error) {\r\n      console.error(\"Token refresh failed:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Public API methods\r\n  destroy() {\r\n    this.popupManager.close();\r\n    this.uiManager.destroy();\r\n    SessionManager.clear();\r\n  }\r\n\r\n  refresh() {\r\n    this.uiManager.destroy();\r\n    this.initialize();\r\n  }\r\n\r\n  getConfig() {\r\n    return this.configManager.get();\r\n  }\r\n\r\n  updateConfig(newConfig) {\r\n    this.configManager.updateConfig(newConfig);\r\n    // Refresh components that depend on config\r\n    this.urlBuilder = new OAuthUrlBuilder(this.configManager.get());\r\n    this.tokenValidator = new TokenValidator(\r\n      this.configManager.get(),\r\n      this.urlBuilder\r\n    );\r\n    this.backendClient = new BackendClient(this.configManager.get());\r\n  }\r\n}\r\n\r\n// =======================\r\n// Auto-initialization and Export\r\n// =======================\r\nif (typeof window !== \"undefined\") {\r\n  window.BjPassAuthWidget = BjPassAuthWidget;\r\n  window.BjPassComponents = {\r\n    ConfigManager,\r\n    CryptoUtils,\r\n    SessionManager,\r\n    UIManager,\r\n    TokenValidator,\r\n    BackendClient,\r\n    PopupManager,\r\n    ErrorHandler,\r\n  };\r\n}\r\n\r\n// Auto-initialization\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n  const containers = document.querySelectorAll(\"[data-bjpass-widget]\");\r\n\r\n  containers.forEach((container) => {\r\n    try {\r\n      const config = container.dataset.bjpassWidget\r\n        ? JSON.parse(container.dataset.bjpassWidget)\r\n        : {};\r\n\r\n      config.ui = { ...config.ui, container: `#${container.id}` };\r\n      new BjPassAuthWidget(config);\r\n    } catch (error) {\r\n      console.error(\"Failed to initialize BjPass widget:\", error);\r\n    }\r\n  });\r\n});\r\n\r\n// =======================\r\n// Widget Factory\r\n// =======================\r\nclass BjPassWidgetFactory {\r\n  static create(config = {}) {\r\n    return new BjPassAuthWidget(config);\r\n  }\r\n\r\n  static createMultiple(configs) {\r\n    return configs.map((config) => new BjPassAuthWidget(config));\r\n  }\r\n\r\n  static createWithTheme(theme, config = {}) {\r\n    const themes = {\r\n      default: {\r\n        primaryColor: \"#0066cc\",\r\n        backgroundColor: \"#ffffff\",\r\n        borderColor: \"#ddd\",\r\n      },\r\n      dark: {\r\n        primaryColor: \"#4da6ff\",\r\n        backgroundColor: \"#2d2d2d\",\r\n        borderColor: \"#555\",\r\n        textColor: \"#ffffff\",\r\n      },\r\n      modern: {\r\n        primaryColor: \"#6366f1\",\r\n        backgroundColor: \"#fafafa\",\r\n        borderColor: \"#e5e7eb\",\r\n      },\r\n      minimal: {\r\n        primaryColor: \"#000000\",\r\n        backgroundColor: \"#ffffff\",\r\n        borderColor: \"transparent\",\r\n      },\r\n    };\r\n\r\n    const themeConfig = themes[theme] || themes.default;\r\n    return new BjPassAuthWidget({\r\n      ...config,\r\n      ui: {\r\n        ...config.ui,\r\n        theme,\r\n        ...themeConfig,\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\n// =======================\r\n// Plugin System\r\n// =======================\r\nclass PluginManager {\r\n  constructor(widget) {\r\n    this.widget = widget;\r\n    this.plugins = new Map();\r\n    this.hooks = new Map();\r\n  }\r\n\r\n  register(name, plugin) {\r\n    if (typeof plugin.init === \"function\") {\r\n      this.plugins.set(name, plugin);\r\n      plugin.init(this.widget);\r\n    }\r\n  }\r\n\r\n  unregister(name) {\r\n    const plugin = this.plugins.get(name);\r\n    if (plugin && typeof plugin.destroy === \"function\") {\r\n      plugin.destroy();\r\n    }\r\n    this.plugins.delete(name);\r\n  }\r\n\r\n  addHook(hookName, callback) {\r\n    if (!this.hooks.has(hookName)) {\r\n      this.hooks.set(hookName, []);\r\n    }\r\n    this.hooks.get(hookName).push(callback);\r\n  }\r\n\r\n  executeHook(hookName, ...args) {\r\n    const callbacks = this.hooks.get(hookName) || [];\r\n    callbacks.forEach((callback) => {\r\n      try {\r\n        callback(...args);\r\n      } catch (error) {\r\n        console.error(`Hook ${hookName} error:`, error);\r\n      }\r\n    });\r\n  }\r\n\r\n  getPlugin(name) {\r\n    return this.plugins.get(name);\r\n  }\r\n\r\n  listPlugins() {\r\n    return Array.from(this.plugins.keys());\r\n  }\r\n}\r\n\r\n// =======================\r\n// Built-in Plugins\r\n// =======================\r\n\r\n// Analytics Plugin\r\nclass AnalyticsPlugin {\r\n  init(widget) {\r\n    this.widget = widget;\r\n    this.setupAnalytics();\r\n  }\r\n\r\n  setupAnalytics() {\r\n    const originalStartAuth = this.widget.startAuthFlow.bind(this.widget);\r\n    const originalHandleSuccess = this.widget.exchangeCodeForTokens.bind(\r\n      this.widget\r\n    );\r\n    // const originalHandleError = this.widget.handleError.bind(this.widget);\r\n\r\n    this.widget.startAuthFlow = async () => {\r\n      this.track(\"auth_started\");\r\n      return originalStartAuth();\r\n    };\r\n\r\n    this.widget.exchangeCodeForTokens = async (code, state) => {\r\n      try {\r\n        const result = await originalHandleSuccess(code, state);\r\n        this.track(\"auth_success\");\r\n        return result;\r\n      } catch (error) {\r\n        this.track(\"auth_error\", { error: error.message });\r\n        throw error;\r\n      }\r\n    };\r\n  }\r\n\r\n  track(event, data = {}) {\r\n    console.log(\"Analytics:\", event, data);\r\n\r\n    // Send to analytics service\r\n    if (typeof gtag !== \"undefined\") {\r\n      //   gtag('event', event, {\r\n      //     event_category: 'bjpass_auth',\r\n      //     ...data\r\n      //   });\r\n    }\r\n\r\n    if (typeof window.analytics !== \"undefined\") {\r\n      window.analytics.track(event, data);\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    // Cleanup if needed\r\n  }\r\n}\r\n\r\n// Debug Plugin\r\nclass DebugPlugin {\r\n  init(widget) {\r\n    this.widget = widget;\r\n    this.originalConsoleLog = console.log;\r\n    this.setupDebugMode();\r\n  }\r\n\r\n  setupDebugMode() {\r\n    if (this.widget.getConfig().debug) {\r\n      this.addDebugPanel();\r\n      this.interceptMethods();\r\n    }\r\n  }\r\n\r\n  addDebugPanel() {\r\n    const debugPanel = document.createElement(\"div\");\r\n    debugPanel.id = \"bjpass-debug-panel\";\r\n    debugPanel.style.cssText = `\r\n      position: fixed;\r\n      top: 10px;\r\n      right: 10px;\r\n      width: 300px;\r\n      max-height: 400px;\r\n      background: rgba(0,0,0,0.9);\r\n      color: #00ff00;\r\n      font-family: monospace;\r\n      font-size: 12px;\r\n      padding: 10px;\r\n      border-radius: 5px;\r\n      overflow-y: auto;\r\n      z-index: 10000;\r\n      display: none;\r\n    `;\r\n\r\n    const header = document.createElement(\"div\");\r\n    header.innerHTML = `\r\n      <strong>BjPass Debug Panel</strong>\r\n      <button onclick=\"this.parentElement.parentElement.style.display='none'\" \r\n              style=\"float:right;background:none;border:none;color:#fff;cursor:pointer;\">×</button>\r\n    `;\r\n\r\n    const logs = document.createElement(\"div\");\r\n    logs.id = \"bjpass-debug-logs\";\r\n\r\n    debugPanel.appendChild(header);\r\n    debugPanel.appendChild(logs);\r\n    document.body.appendChild(debugPanel);\r\n\r\n    // Toggle button\r\n    const toggleBtn = document.createElement(\"button\");\r\n    toggleBtn.textContent = \"🐛\";\r\n    toggleBtn.style.cssText = `\r\n      position: fixed;\r\n      top: 10px;\r\n      right: 10px;\r\n      z-index: 10001;\r\n      background: #000;\r\n      color: #0f0;\r\n      border: none;\r\n      padding: 5px 10px;\r\n      border-radius: 3px;\r\n      cursor: pointer;\r\n    `;\r\n    toggleBtn.onclick = () => {\r\n      debugPanel.style.display =\r\n        debugPanel.style.display === \"none\" ? \"block\" : \"none\";\r\n    };\r\n    document.body.appendChild(toggleBtn);\r\n\r\n    this.debugPanel = debugPanel;\r\n    this.debugLogs = logs;\r\n  }\r\n\r\n  interceptMethods() {\r\n    const methods = [\r\n      \"startAuthFlow\",\r\n      \"handlePopupResponse\",\r\n      \"exchangeCodeForTokens\",\r\n      \"handleError\",\r\n    ];\r\n\r\n    methods.forEach((methodName) => {\r\n      const originalMethod = this.widget[methodName].bind(this.widget);\r\n      this.widget[methodName] = (...args) => {\r\n        this.log(`${methodName} called with:`, args);\r\n        const result = originalMethod(...args);\r\n        if (result instanceof Promise) {\r\n          return result\r\n            .then((res) => {\r\n              this.log(`${methodName} resolved:`, res);\r\n              return res;\r\n            })\r\n            .catch((err) => {\r\n              this.log(`${methodName} rejected:`, err);\r\n              throw err;\r\n            });\r\n        }\r\n        this.log(`${methodName} returned:`, result);\r\n        return result;\r\n      };\r\n    });\r\n  }\r\n\r\n  log(message, data) {\r\n    const timestamp = new Date().toLocaleTimeString();\r\n    const logEntry = document.createElement(\"div\");\r\n    logEntry.style.marginBottom = \"5px\";\r\n    logEntry.innerHTML = `\r\n      <span style=\"color:#888\">[${timestamp}]</span> \r\n      ${message} \r\n      ${data ? `<pre style=\"margin:5px 0;color:#ff0;\">${JSON.stringify(data, null, 2)}</pre>` : \"\"}\r\n    `;\r\n\r\n    if (this.debugLogs) {\r\n      this.debugLogs.appendChild(logEntry);\r\n      this.debugLogs.scrollTop = this.debugLogs.scrollHeight;\r\n    }\r\n\r\n    console.log(`[BjPass Debug] ${message}`, data);\r\n  }\r\n\r\n  destroy() {\r\n    if (this.debugPanel) {\r\n      document.body.removeChild(this.debugPanel);\r\n    }\r\n  }\r\n}\r\n\r\n// Retry Plugin\r\nclass RetryPlugin {\r\n  init(widget) {\r\n    this.widget = widget;\r\n    this.maxRetries = widget.getConfig().maxRetries || 3;\r\n    this.retryDelay = widget.getConfig().retryDelay || 1000;\r\n    this.setupRetryLogic();\r\n  }\r\n\r\n  setupRetryLogic() {\r\n    const originalExchangeCode = this.widget.exchangeCodeForTokens.bind(\r\n      this.widget\r\n    );\r\n\r\n    this.widget.exchangeCodeForTokens = async (code, state, attempt = 1) => {\r\n      try {\r\n        return await originalExchangeCode(code, state);\r\n      } catch (error) {\r\n        if (attempt < this.maxRetries && this.shouldRetry(error)) {\r\n          console.log(\r\n            `Retry attempt ${attempt}/${this.maxRetries} after ${this.retryDelay}ms`\r\n          );\r\n          await this.delay(this.retryDelay * attempt);\r\n          return this.widget.exchangeCodeForTokens(code, state, attempt + 1);\r\n        }\r\n        throw error;\r\n      }\r\n    };\r\n  }\r\n\r\n  shouldRetry(error) {\r\n    const retryableErrors = [\r\n      \"network\",\r\n      \"timeout\",\r\n      \"server_error\",\r\n      \"503\",\r\n      \"502\",\r\n      \"500\",\r\n    ];\r\n    return retryableErrors.some(\r\n      (errType) =>\r\n        error.message.toLowerCase().includes(errType) || error.code === errType\r\n    );\r\n  }\r\n\r\n  delay(ms) {\r\n    return new Promise((resolve) => setTimeout(resolve, ms));\r\n  }\r\n\r\n  destroy() {\r\n    // Cleanup if needed\r\n  }\r\n}\r\n\r\n// Enhanced Widget with Plugin Support\r\nclass EnhancedBjPassAuthWidget extends BjPassAuthWidget {\r\n  constructor(config = {}) {\r\n    super(config);\r\n    this.pluginManager = new PluginManager(this);\r\n    this.setupBuiltinPlugins();\r\n  }\r\n\r\n  setupBuiltinPlugins() {\r\n    const config = this.getConfig();\r\n\r\n    // Auto-enable plugins based on config\r\n    if (config.analytics) {\r\n      this.pluginManager.register(\"analytics\", new AnalyticsPlugin());\r\n    }\r\n\r\n    if (config.debug) {\r\n      this.pluginManager.register(\"debug\", new DebugPlugin());\r\n    }\r\n\r\n    if (config.maxRetries > 0) {\r\n      this.pluginManager.register(\"retry\", new RetryPlugin());\r\n    }\r\n  }\r\n\r\n  // Plugin API\r\n  use(name, plugin) {\r\n    this.pluginManager.register(name, plugin);\r\n    return this;\r\n  }\r\n\r\n  unuse(name) {\r\n    this.pluginManager.unregister(name);\r\n    return this;\r\n  }\r\n\r\n  getPlugin(name) {\r\n    return this.pluginManager.getPlugin(name);\r\n  }\r\n\r\n  // Hook API\r\n  addHook(hookName, callback) {\r\n    this.pluginManager.addHook(hookName, callback);\r\n    return this;\r\n  }\r\n\r\n  executeHook(hookName, ...args) {\r\n    this.pluginManager.executeHook(hookName, ...args);\r\n  }\r\n\r\n  // Enhanced methods with hooks\r\n  async startAuthFlow() {\r\n    this.executeHook(\"beforeAuthStart\");\r\n    try {\r\n      const result = await super.startAuthFlow();\r\n      this.executeHook(\"afterAuthStart\", result);\r\n      return result;\r\n    } catch (error) {\r\n      this.executeHook(\"authStartError\", error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async exchangeCodeForTokens(code, state) {\r\n    this.executeHook(\"beforeTokenExchange\", code, state);\r\n    try {\r\n      const result = await super.exchangeCodeForTokens(code, state);\r\n      this.executeHook(\"afterTokenExchange\", result);\r\n      return result;\r\n    } catch (error) {\r\n      this.executeHook(\"tokenExchangeError\", error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.executeHook(\"beforeDestroy\");\r\n    this.pluginManager.listPlugins().forEach((name) => {\r\n      this.pluginManager.unregister(name);\r\n    });\r\n    super.destroy();\r\n    this.executeHook(\"afterDestroy\");\r\n  }\r\n}\r\n\r\n// =======================\r\n// Exports and Global Setup\r\n// =======================\r\nif (typeof window !== \"undefined\") {\r\n  // Main exports\r\n  window.BjPassAuthWidget = BjPassAuthWidget;\r\n  window.EnhancedBjPassAuthWidget = EnhancedBjPassAuthWidget;\r\n  window.BjPassWidgetFactory = BjPassWidgetFactory;\r\n\r\n  // Component exports\r\n  window.BjPassComponents = {\r\n    ConfigManager,\r\n    CryptoUtils,\r\n    SessionManager,\r\n    UIManager,\r\n    TokenValidator,\r\n    BackendClient,\r\n    PopupManager,\r\n    ErrorHandler,\r\n    PluginManager,\r\n  };\r\n\r\n  // Plugin exports\r\n  window.BjPassPlugins = {\r\n    AnalyticsPlugin,\r\n    DebugPlugin,\r\n    RetryPlugin,\r\n  };\r\n\r\n  // Utility function for quick setup\r\n  window.createBjPassWidget = (config) => {\r\n    return BjPassWidgetFactory.create(config);\r\n  };\r\n}\r\n\r\n// Export par défaut pour ES modules et UMD\r\nif (typeof module !== \"undefined\" && module.exports) {\r\n  module.exports = BjPassAuthWidget;\r\n} else if (typeof define === \"function\" && define.amd) {\r\n  define(() => BjPassAuthWidget);\r\n} else if (typeof exports !== \"undefined\") {\r\n  exports.BjPassAuthWidget = BjPassAuthWidget;\r\n}\r\n\r\n// Export par défaut pour ES modules\r\nexport default BjPassAuthWidget;\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","__webpack_require__.amdO = {};","__webpack_require__.hmd = function(module) {\n\tmodule = Object.create(module);\n\tif (!module.children) module.children = [];\n\tObject.defineProperty(module, 'exports', {\n\t\tenumerable: true,\n\t\tset: function() {\n\t\t\tthrow new Error('ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: ' + module.id);\n\t\t}\n\t});\n\treturn module;\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(204);\n"],"names":["root","factory","exports","module","define","amd","window","ConfigManager","constructor","userConfig","this","environments","test","baseUrl","defaultAuthServer","production","defaultConfig","environment","clientId","authServer","scope","redirectUri","pkce","verifyAccessToken","tokenVerificationScopes","beUrl","beBearer","header","ui","showEnvSelector","container","language","primaryColor","theme","backendUrl","backendEndpoints","start","status","user","logout","refresh","frontendOrigin","backendOrigin","useBackend","popupMode","autoClosePopup","config","resolvedConfig","applyEnvironmentConfig","env","envConfig","updateConfig","newConfig","get","getEnvironments","Object","keys","CryptoUtils","generateRandomString","length","array","Uint8Array","crypto","getRandomValues","Array","from","b","toString","padStart","join","generateCodeChallenge","codeVerifier","data","TextEncoder","encode","digest","subtle","btoa","String","fromCharCode","replace","base64UrlToArrayBuffer","base64Url","padding","repeat","base64","rawData","atob","output","i","charCodeAt","checkBrowserCompatibility","SessionManager","setItem","key","value","sessionStorage","getItem","removeItem","clear","forEach","generateAndStoreAuthData","state","nonce","includes","OAuthUrlBuilder","buildAuthorizationUrl","authData","codeChallenge","authUrl","URL","pathname","encodeURIComponent","params","URLSearchParams","response_type","client_id","redirect_uri","split","code_challenge","code_challenge_method","prompt","set","search","buildTokenUrl","buildJWKSUrl","buildIntrospectionUrl","TokenValidator","urlBuilder","validateIdToken","idToken","payload","decodedHeader","JSON","parse","decodedPayload","now","Math","floor","Date","savedNonce","exp","Error","aud","publicKey","fetchJWKS","find","kid","verifySignature","error","accessToken","response","fetch","method","headers","Authorization","body","token","json","ok","active","jwk","importKey","name","hash","signature","signatureData","verify","UIComponent","element","eventListeners","Map","createElement","tag","className","innerHTML","document","addEventListeners","events","entries","event","handler","addEventListener","has","push","removeEventListeners","listeners","removeEventListener","destroy","parentNode","removeChild","render","show","style","display","hide","EnvironmentSelector","onEnvironmentChange","super","envOptions","map","charAt","toUpperCase","slice","querySelectorAll","radio","change","e","target","appendChild","LoginButton","onLogin","type","cssText","click","mouseover","opacity","mouseout","setLoading","isLoading","disabled","LoadingSpinner","querySelector","getElementById","id","textContent","head","ErrorDisplay","showError","message","clearError","UIManager","components","initialize","createMainContainer","initializeComponents","mainElement","title","envSelector","bind","loginButton","onLoginClick","loadingSpinner","errorDisplay","helpText","onEnvironmentChangeCallback","onLoginCallback","setState","newState","updateUI","values","component","setOnEnvironmentChange","callback","setOnLogin","BackendClient","exchangeCode","code","stringify","code_verifier","errorData","exchangeCodeDirect","grant_type","error_description","handleBackendAuthResponse","handleBackendAuthSuccess","handleBackendAuthError","handleError","popupManager","close","uiManager","configManager","onSuccess","backendData","source","verifyBackendStatus","onError","statusUrl","credentials","Accept","statusData","authenticated","startBackendAuthFlow","startUrl","returnUrl","searchParams","open","getUserInfoFromBackend","userUrl","logoutFromBackend","logoutUrl","PopupManager","popup","checkInterval","url","onClose","left","screen","width","top","height","setInterval","closed","clearInterval","isOpen","ErrorHandler","getErrorMessage","description","errorMessage","errorMessages","invalid_token","unsuported_grant_type_error","insufficient_scope","invalid_grant","access_denied","invalid_request","invalid_scope","server_error","popup_closed","browser_error","backend_error","token_error","token_exchange_error","BjPassAuthWidget","tokenValidator","backendClient","setupMessageListener","setupEventHandlers","startAuthFlow","isValidMessageOrigin","origin","some","allowed","startDirectAuthFlow","handlePopupResponse","queryParams","exchangeCodeForTokens","tokenData","validateTokens","id_token","access_token","errorCode","getUserInfo","userData","onLogout","refreshToken","refreshUrl","token_info","getConfig","BjPassComponents","dataset","bjpassWidget","BjPassWidgetFactory","create","createMultiple","configs","createWithTheme","themes","default","backgroundColor","borderColor","dark","textColor","modern","minimal","themeConfig","PluginManager","widget","plugins","hooks","register","plugin","init","unregister","delete","addHook","hookName","executeHook","args","getPlugin","listPlugins","AnalyticsPlugin","setupAnalytics","originalStartAuth","originalHandleSuccess","async","track","result","analytics","DebugPlugin","originalConsoleLog","console","log","setupDebugMode","debug","addDebugPanel","interceptMethods","debugPanel","logs","toggleBtn","onclick","debugLogs","methodName","originalMethod","Promise","then","res","catch","err","timestamp","toLocaleTimeString","logEntry","marginBottom","scrollTop","scrollHeight","RetryPlugin","maxRetries","retryDelay","setupRetryLogic","originalExchangeCode","attempt","shouldRetry","delay","errType","toLowerCase","ms","resolve","setTimeout","EnhancedBjPassAuthWidget","pluginManager","setupBuiltinPlugins","use","unuse","BjPassPlugins","createBjPassWidget","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","loaded","__webpack_modules__","amdO","hmd","children","defineProperty","enumerable","__webpack_exports__"],"sourceRoot":""}