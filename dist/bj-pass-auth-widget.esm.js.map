{"version":3,"file":"bj-pass-auth-widget.esm.js","mappings":"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","sources":["webpack://bj-pass-auth-widget/./src/bj-pass-auth-widget.js","webpack://bj-pass-auth-widget/webpack/bootstrap","webpack://bj-pass-auth-widget/webpack/runtime/amd options","webpack://bj-pass-auth-widget/webpack/runtime/harmony module decorator","webpack://bj-pass-auth-widget/external module \"react\"","webpack://bj-pass-auth-widget/./src/wrappers/ReactWrapper.tsx","webpack://bj-pass-auth-widget/./src/wrappers/AngularWrapper.ts","webpack://bj-pass-auth-widget/./src/index.ts"],"sourcesContent":["/**\r\n * bj-pass Authentication Widget\r\n * Widget d'authentification OAuth 2.0/OpenID Connect moderne et sécurisé\r\n * @version 1.0.0\r\n * @author yowedjamal\r\n * @license MIT\r\n */\r\n\r\n// =======================\r\n// Configuration Manager\r\n// =======================\r\nclass ConfigManager {\r\n  constructor(userConfig = {}) {\r\n    this.environments = {\r\n      test: {\r\n        baseUrl: \"https://test-tx-pki.gouv.bj\",\r\n        defaultAuthServer: \"main-as\",\r\n      },\r\n      production: {\r\n        baseUrl: \"https://tx-pki.gouv.bj\",\r\n        defaultAuthServer: \"main-as\",\r\n      },\r\n    };\r\n\r\n    this.defaultConfig = {\r\n      environment: \"test\",\r\n      clientId: \"\",\r\n      authServer: \"\",\r\n      scope: \"openid profile\",\r\n      redirectUri: \"http://127.0.0.1:5500/examples/redirect.html\",\r\n      // redirectUri: \"https://bj-pass.vercel.app/redirect.html\",\r\n      pkce: true,\r\n      verifyAccessToken: false,\r\n      tokenVerificationScopes: [\"urn:safelayer:eidas:oauth:token:introspect\"],\r\n      beUrl: \"\",\r\n      beBearer: \"\",\r\n      header: {},\r\n      ui: {\r\n        showEnvSelector: true,\r\n        container: \"#bjpass-auth-container\",\r\n        language: \"fr\",\r\n        primaryColor: \"#0066cc\",\r\n        theme: \"default\",\r\n      },\r\n\r\n      // NOUVELLES OPTIONS BACKEND\r\n      backendUrl: \"https://your-backend.com\", // URL de votre backend Laravel\r\n      backendEndpoints: {\r\n        start: \"/auth/start\", // Endpoint de démarrage\r\n        status: \"/auth/api/status\", // Vérification du statut\r\n        user: \"/auth/api/user\", // Informations utilisateur\r\n        logout: \"/auth/api/logout\", // Déconnexion\r\n        refresh: \"/auth/api/refresh\", // Rafraîchissement token\r\n      },\r\n\r\n      // Configuration de sécurité\r\n      frontendOrigin: \"https://your-frontend.com\", // Origine autorisée\r\n      backendOrigin: \"https://your-backend.com\", // Origine du backend\r\n\r\n      // Options de communication\r\n      useBackend: true, // Activer l'utilisation du backend\r\n      popupMode: true, // Mode popup recommandé\r\n      autoClosePopup: true, // Fermeture automatique après succès\r\n    };\r\n\r\n    this.config = { ...this.defaultConfig, ...userConfig };\r\n    this.resolvedConfig = this.applyEnvironmentConfig();\r\n  }\r\n\r\n  applyEnvironmentConfig() {\r\n    const env = this.config.environment || \"test\";\r\n    const envConfig = this.environments[env] || this.environments.test;\r\n\r\n    return {\r\n      ...this.config,\r\n      baseUrl: envConfig.baseUrl,\r\n      authServer: this.config.authServer || envConfig.defaultAuthServer,\r\n    };\r\n  }\r\n\r\n  updateConfig(newConfig) {\r\n    this.config = { ...this.config, ...newConfig };\r\n    this.resolvedConfig = this.applyEnvironmentConfig();\r\n  }\r\n\r\n  get() {\r\n    return this.resolvedConfig;\r\n  }\r\n\r\n  getEnvironments() {\r\n    return Object.keys(this.environments);\r\n  }\r\n}\r\n\r\n// =======================\r\n// Crypto Utils\r\n// =======================\r\nclass CryptoUtils {\r\n  static generateRandomString(length) {\r\n    const array = new Uint8Array(length);\r\n    window.crypto.getRandomValues(array);\r\n    return Array.from(array, (b) => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n  }\r\n\r\n  static async generateCodeChallenge(codeVerifier) {\r\n    const encoder = new TextEncoder();\r\n    const data = encoder.encode(codeVerifier);\r\n    const digest = await window.crypto.subtle.digest(\"SHA-256\", data);\r\n\r\n    return btoa(String.fromCharCode(...new Uint8Array(digest)))\r\n      .replace(/\\+/g, \"-\")\r\n      .replace(/\\//g, \"_\")\r\n      .replace(/=+$/, \"\");\r\n  }\r\n\r\n  static base64UrlToArrayBuffer(base64Url) {\r\n    const padding = \"=\".repeat((4 - (base64Url.length % 4)) % 4);\r\n    const base64 = base64Url.replace(/-/g, \"+\").replace(/_/g, \"/\") + padding;\r\n    const rawData = atob(base64);\r\n    const output = new Uint8Array(rawData.length);\r\n\r\n    for (let i = 0; i < rawData.length; ++i) {\r\n      output[i] = rawData.charCodeAt(i);\r\n    }\r\n    return output;\r\n  }\r\n\r\n  static checkBrowserCompatibility() {\r\n    return !!(window.crypto && window.crypto.subtle);\r\n  }\r\n}\r\n\r\n// =======================\r\n// Session Manager\r\n// =======================\r\nclass SessionManager {\r\n  static setItem(key, value) {\r\n    sessionStorage.setItem(`tx_auth_${key}`, value);\r\n  }\r\n\r\n  static getItem(key) {\r\n    return sessionStorage.getItem(`tx_auth_${key}`);\r\n  }\r\n\r\n  static removeItem(key) {\r\n    sessionStorage.removeItem(`tx_auth_${key}`);\r\n  }\r\n\r\n  static clear() {\r\n    const keys = [\"state\", \"code_verifier\", \"nonce\", \"success\"];\r\n    keys.forEach((key) => this.removeItem(key));\r\n  }\r\n\r\n  static generateAndStoreAuthData(scope) {\r\n    const state = CryptoUtils.generateRandomString(32);\r\n    const nonce = CryptoUtils.generateRandomString(32);\r\n    const codeVerifier = CryptoUtils.generateRandomString(64);\r\n\r\n    this.setItem(\"state\", state);\r\n    this.setItem(\"code_verifier\", codeVerifier);\r\n\r\n    if (scope.includes(\"openid\")) {\r\n      this.setItem(\"nonce\", nonce);\r\n    }\r\n\r\n    return { state, nonce, codeVerifier };\r\n  }\r\n}\r\n\r\n// =======================\r\n// OAuth URL Builder\r\n// =======================\r\nclass OAuthUrlBuilder {\r\n  constructor(config) {\r\n    this.config = config;\r\n  }\r\n\r\n  async buildAuthorizationUrl(authData) {\r\n    const { state, nonce, codeVerifier } = authData;\r\n    const codeChallenge = await CryptoUtils.generateCodeChallenge(codeVerifier);\r\n\r\n    const authUrl = new URL(`${this.config.baseUrl}/trustedx-authserver/oauth`);\r\n\r\n    if (this.config.authServer) {\r\n      authUrl.pathname += `/${encodeURIComponent(this.config.authServer)}`;\r\n    }\r\n\r\n    const params = new URLSearchParams({\r\n      response_type: \"code\",\r\n      client_id: this.config.clientId,\r\n      redirect_uri: this.config.redirectUri,\r\n      scope: this.config.scope.split(\"+\").join(\" \"),\r\n      state,\r\n      code_challenge: codeChallenge,\r\n      code_challenge_method: \"S256\",\r\n      prompt: \"login\",\r\n    });\r\n\r\n    if (this.config.scope.includes(\"openid\") && nonce) {\r\n      params.set(\"nonce\", nonce);\r\n    }\r\n\r\n    authUrl.search = params.toString();\r\n    return authUrl.toString();\r\n  }\r\n\r\n  buildTokenUrl() {\r\n    return `${this.config.baseUrl}/trustedx-authserver/oauth/${encodeURIComponent(\r\n      this.config.authServer\r\n    )}/token`;\r\n  }\r\n\r\n  buildJWKSUrl() {\r\n    return `${this.config.baseUrl}/trustedx-authserver/oauth/keys`;\r\n  }\r\n\r\n  buildIntrospectionUrl() {\r\n    return `${this.config.baseUrl}/trustedx-authserver/oauth/token/verify`;\r\n  }\r\n}\r\n\r\n// =======================\r\n// Token Validator\r\n// =======================\r\nclass TokenValidator {\r\n  constructor(config, urlBuilder) {\r\n    this.config = config;\r\n    this.urlBuilder = urlBuilder;\r\n  }\r\n\r\n  async validateIdToken(idToken) {\r\n    try {\r\n      const [header, payload] = idToken.split(\".\");\r\n      const decodedHeader = JSON.parse(atob(header));\r\n      const decodedPayload = JSON.parse(atob(payload));\r\n\r\n      // Basic validations\r\n      const now = Math.floor(Date.now() / 1000);\r\n      const savedNonce = SessionManager.getItem(\"nonce\");\r\n\r\n      if (decodedPayload.exp < now) {\r\n        throw new Error(\"Token expired\");\r\n      }\r\n\r\n      if (decodedPayload.nonce !== savedNonce) {\r\n        throw new Error(\"Invalid nonce\");\r\n      }\r\n\r\n      if (decodedPayload.aud !== this.config.clientId) {\r\n        throw new Error(\"Invalid audience\");\r\n      }\r\n\r\n      // Signature validation\r\n      const jwks = await this.fetchJWKS();\r\n      const publicKey = jwks.keys.find((key) => key.kid === decodedHeader.kid);\r\n\r\n      if (!publicKey) {\r\n        throw new Error(\"No matching public key found\");\r\n      }\r\n\r\n      const isValid = await this.verifySignature(idToken, publicKey);\r\n      if (!isValid) {\r\n        throw new Error(\"Invalid signature\");\r\n      }\r\n\r\n      return decodedPayload;\r\n    } catch (error) {\r\n      console.error(\"ID Token validation failed:\", error);\r\n      throw new Error(\"Invalid ID Token\");\r\n    }\r\n  }\r\n\r\n  async verifyAccessToken(accessToken) {\r\n    try {\r\n      const response = await fetch(this.urlBuilder.buildIntrospectionUrl(), {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/x-www-form-urlencoded\",\r\n          Authorization: `Bearer ${accessToken}`,\r\n        },\r\n        body: new URLSearchParams({ token: accessToken }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (!response.ok || !data.active) {\r\n        throw new Error(\"Token verification failed\");\r\n      }\r\n\r\n      return data;\r\n    } catch (error) {\r\n      console.error(\"Token verification error:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async fetchJWKS() {\r\n    const response = await fetch(this.urlBuilder.buildJWKSUrl());\r\n    if (!response.ok) {\r\n      throw new Error(\"Failed to fetch JWKS\");\r\n    }\r\n    return await response.json();\r\n  }\r\n\r\n  async verifySignature(token, jwk) {\r\n    try {\r\n      const key = await window.crypto.subtle.importKey(\r\n        \"jwk\",\r\n        jwk,\r\n        { name: \"RSASSA-PKCS1-v1_5\", hash: { name: \"SHA-256\" } },\r\n        false,\r\n        [\"verify\"]\r\n      );\r\n\r\n      const [header, payload, signature] = token.split(\".\");\r\n      const signatureData = CryptoUtils.base64UrlToArrayBuffer(signature);\r\n      const data = new TextEncoder().encode(`${header}.${payload}`);\r\n\r\n      return await window.crypto.subtle.verify(\r\n        \"RSASSA-PKCS1-v1_5\",\r\n        key,\r\n        signatureData,\r\n        data\r\n      );\r\n    } catch (error) {\r\n      console.error(\"Signature verification error:\", error);\r\n      return false;\r\n    }\r\n  }\r\n}\r\n\r\n// =======================\r\n// UI Component Base Class\r\n// =======================\r\nclass UIComponent {\r\n  constructor(container) {\r\n    this.container = container;\r\n    this.element = null;\r\n    this.eventListeners = new Map();\r\n  }\r\n\r\n  createElement(tag, className = \"\", innerHTML = \"\") {\r\n    const element = document.createElement(tag);\r\n    if (className) element.className = className;\r\n    if (innerHTML) element.innerHTML = innerHTML;\r\n    return element;\r\n  }\r\n\r\n  addEventListeners(element, events) {\r\n    Object.entries(events).forEach(([event, handler]) => {\r\n      element.addEventListener(event, handler);\r\n\r\n      // Store for cleanup\r\n      if (!this.eventListeners.has(element)) {\r\n        this.eventListeners.set(element, []);\r\n      }\r\n      this.eventListeners.get(element).push({ event, handler });\r\n    });\r\n  }\r\n\r\n  removeEventListeners() {\r\n    this.eventListeners.forEach((listeners, element) => {\r\n      listeners.forEach(({ event, handler }) => {\r\n        element.removeEventListener(event, handler);\r\n      });\r\n    });\r\n    this.eventListeners.clear();\r\n  }\r\n\r\n  destroy() {\r\n    this.removeEventListeners();\r\n    if (this.element && this.element.parentNode) {\r\n      this.element.parentNode.removeChild(this.element);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    throw new Error(\"render() must be implemented by subclass\");\r\n  }\r\n\r\n  show() {\r\n    if (this.element) this.element.style.display = \"block\";\r\n  }\r\n\r\n  hide() {\r\n    if (this.element) this.element.style.display = \"none\";\r\n  }\r\n}\r\n\r\n// =======================\r\n// UI Components\r\n// =======================\r\nclass EnvironmentSelector extends UIComponent {\r\n  constructor(container, config, onEnvironmentChange) {\r\n    super(container);\r\n    this.config = config;\r\n    this.onEnvironmentChange = onEnvironmentChange;\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    if (!this.config.ui.showEnvSelector) return;\r\n\r\n    const envOptions = this.config\r\n      .getEnvironments()\r\n      .map(\r\n        (env) => `\r\n        <label>\r\n          <input type=\"radio\" name=\"env\" value=\"${env}\" ${env === this.config.get().environment ? \"checked\" : \"\"}>\r\n          ${env.charAt(0).toUpperCase() + env.slice(1)}\r\n        </label>\r\n      `\r\n      )\r\n      .join(\"\");\r\n\r\n    this.element = this.createElement(\r\n      \"div\",\r\n      \"bjpass-env-selector\",\r\n      `\r\n      <div class=\"env-selector-label\">Environment:</div>\r\n      ${envOptions}\r\n    `\r\n    );\r\n\r\n    const radioInputs = this.element.querySelectorAll('input[name=\"env\"]');\r\n    radioInputs.forEach((radio) => {\r\n      this.addEventListeners(radio, {\r\n        change: (e) => this.onEnvironmentChange(e.target.value),\r\n      });\r\n    });\r\n\r\n    this.container.appendChild(this.element);\r\n  }\r\n}\r\n\r\nclass LoginButton extends UIComponent {\r\n  constructor(container, config, onLogin) {\r\n    super(container);\r\n    this.config = config;\r\n    this.onLogin = onLogin;\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    this.element = this.createElement(\r\n      \"button\",\r\n      \"bjpass-login-btn\",\r\n      \"Se connecter\"\r\n    );\r\n    this.element.type = \"button\";\r\n    this.element.style.cssText = `\r\n      width: 100%;\r\n      padding: 12px 24px;\r\n      background-color: ${this.config.ui.primaryColor};\r\n      color: white;\r\n      border: none;\r\n      border-radius: 6px;\r\n      font-size: 16px;\r\n      cursor: pointer;\r\n      transition: background-color 0.2s;\r\n    `;\r\n\r\n    this.addEventListeners(this.element, {\r\n      click: this.onLogin,\r\n      mouseover: () => {\r\n        this.element.style.opacity = \"0.9\";\r\n      },\r\n      mouseout: () => {\r\n        this.element.style.opacity = \"1\";\r\n      },\r\n    });\r\n\r\n    this.container.appendChild(this.element);\r\n  }\r\n\r\n  setLoading(isLoading) {\r\n    this.element.disabled = isLoading;\r\n    this.element.innerHTML = isLoading ? \"Connexion...\" : \"Se connecter\";\r\n  }\r\n}\r\n\r\nclass LoadingSpinner extends UIComponent {\r\n  constructor(container) {\r\n    super(container);\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    this.element = this.createElement(\r\n      \"div\",\r\n      \"bjpass-loading\",\r\n      `\r\n      <div class=\"spinner\"></div>\r\n      <div class=\"loading-text\">Authentification en cours...</div>\r\n    `\r\n    );\r\n\r\n    this.element.style.cssText = `\r\n      display: none;\r\n      text-align: center;\r\n      padding: 20px;\r\n    `;\r\n\r\n    const spinner = this.element.querySelector(\".spinner\");\r\n    spinner.style.cssText = `\r\n      border: 3px solid #f3f3f3;\r\n      border-radius: 50%;\r\n      border-top: 3px solid #0066cc;\r\n      width: 30px;\r\n      height: 30px;\r\n      animation: spin 1s linear infinite;\r\n      margin: 0 auto 10px;\r\n    `;\r\n\r\n    // Add CSS animation\r\n    if (!document.getElementById(\"bjpass-spinner-styles\")) {\r\n      const style = document.createElement(\"style\");\r\n      style.id = \"bjpass-spinner-styles\";\r\n      style.textContent = `\r\n        @keyframes spin {\r\n          0% { transform: rotate(0deg); }\r\n          100% { transform: rotate(360deg); }\r\n        }\r\n      `;\r\n      document.head.appendChild(style);\r\n    }\r\n\r\n    this.container.appendChild(this.element);\r\n  }\r\n}\r\n\r\nclass ErrorDisplay extends UIComponent {\r\n  constructor(container, config) {\r\n    super(container);\r\n    this.config = config;\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    this.element = this.createElement(\"div\", \"bjpass-error\");\r\n    this.element.style.cssText = `\r\n      display: none;\r\n      padding: 12px;\r\n      margin: 10px 0;\r\n      background-color: #fee;\r\n      border: 1px solid #fcc;\r\n      border-radius: 4px;\r\n      color: #c33;\r\n      font-size: 14px;\r\n    `;\r\n\r\n    this.container.appendChild(this.element);\r\n  }\r\n\r\n  showError(message) {\r\n    this.element.textContent = message;\r\n    this.show();\r\n  }\r\n\r\n  clearError() {\r\n    this.element.textContent = \"\";\r\n    this.hide();\r\n  }\r\n}\r\n\r\n// =======================\r\n// UI Manager\r\n// =======================\r\nclass UIManager {\r\n  constructor(config) {\r\n    this.config = config;\r\n    this.container = null;\r\n    this.components = {};\r\n    this.state = {\r\n      isLoading: false,\r\n      error: null,\r\n    };\r\n  }\r\n\r\n  initialize() {\r\n    this.container = document.querySelector(this.config.ui.container);\r\n    if (!this.container) {\r\n      throw new Error(`Container ${this.config.ui.container} not found`);\r\n    }\r\n\r\n    this.createMainContainer();\r\n    this.initializeComponents();\r\n  }\r\n\r\n  createMainContainer() {\r\n    this.mainElement = document.createElement(\"div\");\r\n    this.mainElement.className = \"bjpass-widget\";\r\n    this.mainElement.style.cssText = `\r\n      max-width: 400px;\r\n      margin: 0 auto;\r\n      padding: 20px;\r\n      border: 1px solid #ddd;\r\n      border-radius: 8px;\r\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n    `;\r\n\r\n    const title = document.createElement(\"h3\");\r\n    title.textContent = \"Authentification BjPass\";\r\n    title.style.cssText = `\r\n      color: ${this.config.ui.primaryColor};\r\n      text-align: center;\r\n      margin: 0 0 20px 0;\r\n    `;\r\n\r\n    this.mainElement.appendChild(title);\r\n    this.container.appendChild(this.mainElement);\r\n  }\r\n\r\n  initializeComponents() {\r\n    // Environment selector\r\n    this.components.envSelector = new EnvironmentSelector(\r\n      this.mainElement,\r\n      this.config,\r\n      this.onEnvironmentChange.bind(this)\r\n    );\r\n\r\n    // Login button\r\n    this.components.loginButton = new LoginButton(\r\n      this.mainElement,\r\n      this.config,\r\n      this.onLoginClick.bind(this)\r\n    );\r\n\r\n    // Loading spinner\r\n    this.components.loadingSpinner = new LoadingSpinner(this.mainElement);\r\n\r\n    // Error display\r\n    this.components.errorDisplay = new ErrorDisplay(\r\n      this.mainElement,\r\n      this.config\r\n    );\r\n\r\n    // Help text\r\n    const helpText = document.createElement(\"p\");\r\n    helpText.textContent =\r\n      \"Vous serez redirigé vers le service d'authentification sécurisée\";\r\n    helpText.style.cssText = `\r\n      text-align: center;\r\n      margin: 15px 0 0 0;\r\n      font-size: 0.9em;\r\n      color: #666;\r\n    `;\r\n    this.mainElement.appendChild(helpText);\r\n  }\r\n\r\n  onEnvironmentChange(environment) {\r\n    if (this.onEnvironmentChangeCallback) {\r\n      this.onEnvironmentChangeCallback(environment);\r\n    }\r\n  }\r\n\r\n  onLoginClick() {\r\n    if (this.onLoginCallback) {\r\n      this.onLoginCallback();\r\n    }\r\n  }\r\n\r\n  setState(newState) {\r\n    this.state = { ...this.state, ...newState };\r\n    this.updateUI();\r\n  }\r\n\r\n  updateUI() {\r\n    if (this.state.isLoading) {\r\n      this.components.loginButton.setLoading(true);\r\n      this.components.loadingSpinner.show();\r\n      this.components.errorDisplay.clearError();\r\n    } else {\r\n      this.components.loginButton.setLoading(false);\r\n      this.components.loadingSpinner.hide();\r\n\r\n      if (this.state.error) {\r\n        this.components.errorDisplay.showError(this.state.error);\r\n      } else {\r\n        this.components.errorDisplay.clearError();\r\n      }\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    Object.values(this.components).forEach((component) => {\r\n      if (component.destroy) component.destroy();\r\n    });\r\n\r\n    if (this.mainElement && this.mainElement.parentNode) {\r\n      this.mainElement.parentNode.removeChild(this.mainElement);\r\n    }\r\n  }\r\n\r\n  // Event handler setters\r\n  setOnEnvironmentChange(callback) {\r\n    this.onEnvironmentChangeCallback = callback;\r\n  }\r\n\r\n  setOnLogin(callback) {\r\n    this.onLoginCallback = callback;\r\n  }\r\n}\r\n\r\n// =======================\r\n// Backend Client\r\n// =======================\r\nclass BackendClient {\r\n  constructor(config) {\r\n    this.config = config;\r\n  }\r\n\r\n  async exchangeCode(code, state) {\r\n    const response = await fetch(this.config.beUrl, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        ...this.config.header,\r\n      },\r\n      body: JSON.stringify({\r\n        code,\r\n        state,\r\n        redirect_uri: this.config.redirectUri,\r\n        code_verifier: SessionManager.getItem(\"code_verifier\"),\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorData = await response.json();\r\n      throw new Error(errorData.message || \"Échec de l'authentification\");\r\n    }\r\n\r\n    return await response.json();\r\n  }\r\n\r\n  async exchangeCodeDirect(code, state, urlBuilder) {\r\n    const codeVerifier = SessionManager.getItem(\"code_verifier\");\r\n    if (!codeVerifier) {\r\n      throw new Error(\"Missing code verifier\");\r\n    }\r\n\r\n    const response = await fetch(urlBuilder.buildTokenUrl(), {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\r\n      },\r\n      body: new URLSearchParams({\r\n        grant_type: \"authorization_code\",\r\n        code,\r\n        redirect_uri: this.config.redirectUri,\r\n        client_id: this.config.clientId,\r\n        code_verifier: codeVerifier,\r\n      }),\r\n    });\r\n\r\n    const data = await response.json();\r\n\r\n    if (!response.ok) {\r\n      throw new Error(data.error_description || \"Failed to obtain token\");\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  async handleBackendAuthResponse(data) {\r\n    try {\r\n      if (data.status === \"success\") {\r\n        // Authentification réussie\r\n        await this.handleBackendAuthSuccess(data);\r\n      } else {\r\n        // Erreur d'authentification\r\n        this.handleBackendAuthError(data);\r\n      }\r\n    } catch (error) {\r\n      this.handleError(\"callback_error\", error.message);\r\n    }\r\n  }\r\n\r\n  async handleBackendAuthSuccess(data) {\r\n    try {\r\n      // Stocker les informations utilisateur\r\n      SessionManager.setItem(\"user\", JSON.stringify(data.user));\r\n      SessionManager.setItem(\"success\", \"true\");\r\n\r\n      // Fermer la popup\r\n      this.popupManager.close();\r\n\r\n      // Mettre à jour l'UI\r\n      this.uiManager.setState({ isLoading: false, error: null });\r\n\r\n      // Appeler le callback de succès\r\n      const config = this.config;\r\n      if (config.onSuccess) {\r\n        config.onSuccess({\r\n          user: data.user,\r\n          backendData: data,\r\n          source: \"backend\",\r\n        });\r\n      }\r\n\r\n      // Vérifier le statut via l'API backend\r\n      await this.verifyBackendStatus();\r\n    } catch (error) {\r\n      this.handleError(\"success_verification_error\", error.message);\r\n    }\r\n  }\r\n\r\n  handleBackendAuthError(data) {\r\n    // Fermer la popup\r\n    this.popupManager.close();\r\n\r\n    // Afficher l'erreur\r\n    this.handleError(\r\n      data.error || \"backend_error\",\r\n      data.message || \"Erreur d'authentification\"\r\n    );\r\n\r\n    // Appeler le callback d'erreur\r\n    const config = this.config;\r\n    if (config.onError) {\r\n      config.onError({\r\n        error: data.error,\r\n        error_description: data.message,\r\n        source: \"backend\",\r\n      });\r\n    }\r\n  }\r\n\r\n  async verifyBackendStatus() {\r\n    try {\r\n      const config = this.config;\r\n      const statusUrl = new URL(\r\n        config.backendEndpoints.status,\r\n        config.backendUrl\r\n      );\r\n\r\n      const response = await fetch(statusUrl.toString(), {\r\n        method: \"GET\",\r\n        credentials: \"include\", // Inclure les cookies de session\r\n        headers: {\r\n          Accept: \"application/json\",\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Status check failed: ${response.status}`);\r\n      }\r\n\r\n      const statusData = await response.json();\r\n\r\n      if (statusData.authenticated) {\r\n        // Mettre à jour les informations utilisateur\r\n        SessionManager.setItem(\"user\", JSON.stringify(statusData.user));\r\n        SessionManager.setItem(\"authenticated\", \"true\");\r\n\r\n        console.log(\"Backend status verified:\", statusData);\r\n      } else {\r\n        // L'utilisateur n'est pas authentifié côté backend\r\n        SessionManager.clear();\r\n        throw new Error(\"User not authenticated on backend\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Backend status verification failed:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async startBackendAuthFlow() {\r\n    const config = this.config;\r\n\r\n    if (!config.backendUrl) {\r\n      throw new Error(\"Backend URL not configured\");\r\n    }\r\n\r\n    // Construire l'URL de démarrage du backend\r\n    const startUrl = new URL(config.backendEndpoints.start, config.backendUrl);\r\n\r\n    // Ajouter des paramètres optionnels\r\n    if (config.returnUrl) {\r\n      startUrl.searchParams.set(\"return_url\", config.returnUrl);\r\n    }\r\n\r\n    // Ouvrir la popup vers le backend\r\n    this.popupManager.open(startUrl.toString(), () => {\r\n      this.uiManager.setState({ isLoading: false });\r\n      if (!SessionManager.getItem(\"success\")) {\r\n        this.handleError(\r\n          \"popup_closed\",\r\n          \"La fenêtre d'authentification a été fermée\"\r\n        );\r\n      }\r\n    });\r\n  }\r\n\r\n  async getUserInfoFromBackend() {\r\n    const config = this.config;\r\n    const userUrl = new URL(config.backendEndpoints.user, config.backendUrl);\r\n\r\n    const response = await fetch(userUrl.toString(), {\r\n      method: \"GET\",\r\n      credentials: \"include\",\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`User info request failed: ${response.status}`);\r\n    }\r\n\r\n    const userData = await response.json();\r\n    return userData.user;\r\n  }\r\n\r\n  async logoutFromBackend() {\r\n    const config = this.config;\r\n    const logoutUrl = new URL(\r\n      config.backendEndpoints.logout,\r\n      config.backendUrl\r\n    );\r\n\r\n    const response = await fetch(logoutUrl.toString(), {\r\n      method: \"POST\",\r\n      credentials: \"include\",\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`Backend logout failed: ${response.status}`);\r\n    }\r\n\r\n    console.log(\"Backend logout successful\");\r\n  }\r\n}\r\n\r\n// =======================\r\n// Popup Manager\r\n// =======================\r\nclass PopupManager {\r\n  constructor() {\r\n    this.popup = null;\r\n    this.checkInterval = null;\r\n  }\r\n\r\n  open(url, onClose) {\r\n    const width = 500;\r\n    const height = 600;\r\n    const left = (screen.width - width) / 2;\r\n    const top = (screen.height - height) / 2;\r\n\r\n    this.popup = window.open(\r\n      url,\r\n      \"BjPassAuth\",\r\n      `width=${width},height=${height},top=${top},left=${left},resizable=yes,scrollbars=yes`\r\n    );\r\n\r\n    // Check if popup is closed\r\n    this.checkInterval = setInterval(() => {\r\n      if (this.popup && this.popup.closed) {\r\n        this.close();\r\n        if (onClose) onClose();\r\n      }\r\n    }, 500);\r\n  }\r\n\r\n  close() {\r\n    if (this.checkInterval) {\r\n      clearInterval(this.checkInterval);\r\n      this.checkInterval = null;\r\n    }\r\n\r\n    if (this.popup && !this.popup.closed) {\r\n      this.popup.close();\r\n    }\r\n\r\n    this.popup = null;\r\n  }\r\n\r\n  isOpen() {\r\n    return this.popup && !this.popup.closed;\r\n  }\r\n}\r\n\r\n// =======================\r\n// Error Handler\r\n// =======================\r\nclass ErrorHandler {\r\n  static getErrorMessage(error, description) {\r\n    let errorMessage = \"Erreur d'authentification\";\r\n\r\n    const errorMessages = {\r\n      invalid_token: \"Token invalide ou expiré\",\r\n      unsuported_grant_type_error: \"Type de subvention OAuth invalide\",\r\n      insufficient_scope: \"Permissions insuffisantes\",\r\n      invalid_grant: \"Code d'autorisation invalide ou expiré\",\r\n      access_denied: \"Authentification annulée\",\r\n      invalid_request: \"Requête invalide\",\r\n      invalid_scope: \"Permissions invalides\",\r\n      server_error: \"Erreur du serveur\",\r\n      popup_closed: \"La fenêtre d'authentification a été fermée\",\r\n      browser_error: \"Navigateur non supporté\",\r\n      backend_error: \"Erreur du backend\",\r\n      token_error: \"Erreur de validation du token\",\r\n      token_exchange_error: \"Erreur lors de l'échange\",\r\n    };\r\n\r\n    if (errorMessages[error]) {\r\n      errorMessage = errorMessages[error];\r\n    }\r\n\r\n    if (description) {\r\n      errorMessage += `: ${description}`;\r\n    }\r\n\r\n    return errorMessage;\r\n  }\r\n}\r\n\r\n// =======================\r\n// Main Widget Class\r\n// =======================\r\nclass BjPassAuthWidget {\r\n  constructor(config = {}) {\r\n    // Initialize modules\r\n    this.configManager = new ConfigManager(config);\r\n    this.uiManager = new UIManager(this.configManager.get());\r\n    this.urlBuilder = new OAuthUrlBuilder(this.configManager.get());\r\n    this.tokenValidator = new TokenValidator(\r\n      this.configManager.get(),\r\n      this.urlBuilder\r\n    );\r\n    this.backendClient = new BackendClient(this.configManager.get());\r\n    this.popupManager = new PopupManager();\r\n\r\n    // Check browser compatibility\r\n    if (!CryptoUtils.checkBrowserCompatibility()) {\r\n      throw new Error(\"Browser not supported. Please use a modern browser.\");\r\n    }\r\n\r\n    // Initialize UI\r\n    this.initialize();\r\n\r\n    // Setup global message listener\r\n    this.setupMessageListener();\r\n  }\r\n\r\n  initialize() {\r\n    this.uiManager.initialize();\r\n    this.setupEventHandlers();\r\n  }\r\n\r\n  setupEventHandlers() {\r\n    this.uiManager.setOnEnvironmentChange((environment) => {\r\n      this.configManager.updateConfig({ environment });\r\n      this.urlBuilder = new OAuthUrlBuilder(this.configManager.get());\r\n      this.tokenValidator = new TokenValidator(\r\n        this.configManager.get(),\r\n        this.urlBuilder\r\n      );\r\n      this.backendClient = new BackendClient(this.configManager.get());\r\n    });\r\n\r\n    this.uiManager.setOnLogin(() => {\r\n      this.startAuthFlow();\r\n    });\r\n  }\r\n\r\n  // setupMessageListener() {\r\n  //   window.addEventListener(\"message\", (event) => {\r\n  //     if (event.data.type === \"bjpass-auth-response\") {\r\n  //       this.handlePopupResponse(event.data.query);\r\n  //     }\r\n  //   });\r\n  // }\r\n\r\n  setupMessageListener() {\r\n    window.addEventListener(\"message\", (event) => {\r\n      // Vérifier l'origine du message\r\n      if (!this.isValidMessageOrigin(event.origin)) {\r\n        console.warn(\"Message from unauthorized origin:\", event.origin);\r\n        return;\r\n      }\r\n\r\n      // Vérifier le type de message\r\n      if (event.data && event.data.type === \"bjpass-auth-response\") {\r\n        this.backendClient.handleBackendAuthResponse(event.data);\r\n      }\r\n    });\r\n  }\r\n\r\n  isValidMessageOrigin(origin) {\r\n    const config = this.configManager.get();\r\n    const allowedOrigins = [config.backendOrigin, config.frontendOrigin];\r\n\r\n    // Permettre l'origine exacte ou wildcard\r\n    return allowedOrigins.some(\r\n      (allowed) => allowed === \"*\" || allowed === origin\r\n    );\r\n  }\r\n\r\n  async startAuthFlow() {\r\n    try {\r\n    const config = this.configManager.get();\r\n\r\n      this.uiManager.setState({ isLoading: true, error: null });\r\n\r\n      if (config.useBackend) {\r\n        // Utiliser le backend pour l'authentification\r\n        await this.backendClient.startBackendAuthFlow();\r\n      } else {\r\n        // Fallback vers l'ancienne méthode\r\n        await this.startDirectAuthFlow();\r\n      }\r\n    } catch (error) {\r\n      this.handleError(\"auth_flow_error\", error.message);\r\n    }\r\n  }\r\n\r\n  async startDirectAuthFlow() {\r\n    // Ancienne logique existante...\r\n    const config = this.configManager.get();\r\n    const authData = SessionManager.generateAndStoreAuthData(config.scope);\r\n    const authUrl = await this.urlBuilder.buildAuthorizationUrl(authData);\r\n\r\n    this.popupManager.open(authUrl, () => {\r\n      this.uiManager.setState({ isLoading: false });\r\n      if (!SessionManager.getItem(\"success\")) {\r\n        this.handleError(\r\n          \"popup_closed\",\r\n          \"La fenêtre d'authentification a été fermée\"\r\n        );\r\n      }\r\n    });\r\n  }\r\n\r\n  async handlePopupResponse(queryParams) {\r\n    try {\r\n      const params = new URLSearchParams(queryParams);\r\n      const code = params.get(\"code\");\r\n      const state = params.get(\"state\");\r\n      const error = params.get(\"error\");\r\n\r\n      if (error) {\r\n        this.handleError(error, params.get(\"error_description\"));\r\n        return;\r\n      }\r\n\r\n      if (!code || !state) {\r\n        this.handleError(\"invalid_response\", \"Code ou state manquant\");\r\n        return;\r\n      }\r\n\r\n      // Validate state\r\n      const savedState = SessionManager.getItem(\"state\");\r\n      if (state !== savedState) {\r\n        this.handleError(\"invalid_state\", \"Paramètre state invalide\");\r\n        return;\r\n      }\r\n\r\n      SessionManager.setItem(\"success\", \"true\");\r\n      this.popupManager.close();\r\n\r\n      // Exchange code for tokens\r\n      await this.exchangeCodeForTokens(code, state);\r\n    } catch (error) {\r\n      this.handleError(\"callback_error\", error.message);\r\n    }\r\n  }\r\n\r\n  async exchangeCodeForTokens(code, state) {\r\n    try {\r\n      const config = this.configManager.get();\r\n      let tokenData;\r\n\r\n      // Use backend or direct exchange based on configuration\r\n      if (config.beUrl) {\r\n        tokenData = await this.backendClient.exchangeCode(code, state);\r\n      } else {\r\n        this.handleError(\r\n          \"unsuported_grant_type_error\",\r\n          \"Type de subvention OAuth non encore pris en charge.\"\r\n        );\r\n        return;\r\n      }\r\n\r\n      // Validate tokens\r\n      await this.validateTokens(tokenData.data);\r\n\r\n      // Success\r\n      SessionManager.clear();\r\n      this.uiManager.setState({ isLoading: false, error: null });\r\n\r\n      if (config.onSuccess) {\r\n        config.onSuccess(tokenData);\r\n      }\r\n    } catch (error) {\r\n      this.handleError(\"token_exchange_error\", error.message);\r\n    }\r\n  }\r\n\r\n  async validateTokens(tokenData) {\r\n    const config = this.configManager.get();\r\n\r\n    // Validate ID token if present\r\n    if (tokenData.id_token && config.scope.includes(\"openid\")) {\r\n      await this.tokenValidator.validateIdToken(tokenData.id_token);\r\n    }\r\n\r\n    // Verify access token if requested\r\n    if (config.verifyAccessToken && tokenData.access_token) {\r\n      await this.tokenValidator.verifyAccessToken(tokenData.access_token);\r\n    }\r\n  }\r\n\r\n  handleError(errorCode, description) {\r\n    console.error(\"Auth error:\", errorCode, description);\r\n\r\n    const errorMessage = ErrorHandler.getErrorMessage(errorCode, description);\r\n\r\n    this.uiManager.setState({\r\n      isLoading: false,\r\n      error: errorMessage,\r\n    });\r\n\r\n    const config = this.configManager.get();\r\n    if (config.onError) {\r\n      config.onError({ error: errorCode, error_description: description });\r\n    }\r\n  }\r\n\r\n  async getUserInfo() {\r\n    const config = this.configManager.get();\r\n\r\n    if (config.useBackend) {\r\n      try {\r\n        // Essayer de récupérer depuis le backend\r\n        return await this.backendClient.getUserInfoFromBackend();\r\n      } catch (error) {\r\n        console.warn(\r\n          \"Failed to get user info from backend, falling back to session:\",\r\n          error\r\n        );\r\n      }\r\n    }\r\n\r\n    // Fallback vers la session locale\r\n    const userData = SessionManager.getItem(\"user\");\r\n    return userData ? JSON.parse(userData) : null;\r\n  }\r\n\r\n  async logout() {\r\n    const config = this.configManager.get();\r\n\r\n    if (config.useBackend) {\r\n      try {\r\n        await this.backendClient.logoutFromBackend();\r\n      } catch (error) {\r\n        console.warn(\"Backend logout failed:\", error);\r\n      }\r\n    }\r\n\r\n    // Nettoyer la session locale\r\n    SessionManager.clear();\r\n\r\n    // Mettre à jour l'UI\r\n    this.uiManager.setState({ isLoading: false, error: null });\r\n\r\n    // Appeler le callback de déconnexion\r\n    if (config.onLogout) {\r\n      config.onLogout();\r\n    }\r\n  }\r\n\r\n  async refreshToken() {\r\n    const config = this.configManager.get();\r\n\r\n    if (!config.useBackend) {\r\n      throw new Error(\"Token refresh not supported in direct mode\");\r\n    }\r\n\r\n    try {\r\n      const refreshUrl = new URL(\r\n        config.backendEndpoints.refresh,\r\n        config.backendUrl\r\n      );\r\n\r\n      const response = await fetch(refreshUrl.toString(), {\r\n        method: \"POST\",\r\n        credentials: \"include\",\r\n        headers: {\r\n          Accept: \"application/json\",\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Token refresh failed: ${response.status}`);\r\n      }\r\n\r\n      const refreshData = await response.json();\r\n      console.log(\"Token refreshed successfully\");\r\n\r\n      return refreshData.token_info;\r\n    } catch (error) {\r\n      console.error(\"Token refresh failed:\", error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // Public API methods\r\n  destroy() {\r\n    this.popupManager.close();\r\n    this.uiManager.destroy();\r\n    SessionManager.clear();\r\n  }\r\n\r\n  refresh() {\r\n    this.uiManager.destroy();\r\n    this.initialize();\r\n  }\r\n\r\n  getConfig() {\r\n    return this.configManager.get();\r\n  }\r\n\r\n  updateConfig(newConfig) {\r\n    this.configManager.updateConfig(newConfig);\r\n    // Refresh components that depend on config\r\n    this.urlBuilder = new OAuthUrlBuilder(this.configManager.get());\r\n    this.tokenValidator = new TokenValidator(\r\n      this.configManager.get(),\r\n      this.urlBuilder\r\n    );\r\n    this.backendClient = new BackendClient(this.configManager.get());\r\n  }\r\n}\r\n\r\n// =======================\r\n// Auto-initialization and Export\r\n// =======================\r\nif (typeof window !== \"undefined\") {\r\n  window.BjPassAuthWidget = BjPassAuthWidget;\r\n  window.BjPassComponents = {\r\n    ConfigManager,\r\n    CryptoUtils,\r\n    SessionManager,\r\n    UIManager,\r\n    TokenValidator,\r\n    BackendClient,\r\n    PopupManager,\r\n    ErrorHandler,\r\n  };\r\n}\r\n\r\n// Auto-initialization\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n  const containers = document.querySelectorAll(\"[data-bjpass-widget]\");\r\n\r\n  containers.forEach((container) => {\r\n    try {\r\n      const config = container.dataset.bjpassWidget\r\n        ? JSON.parse(container.dataset.bjpassWidget)\r\n        : {};\r\n\r\n      config.ui = { ...config.ui, container: `#${container.id}` };\r\n      new BjPassAuthWidget(config);\r\n    } catch (error) {\r\n      console.error(\"Failed to initialize BjPass widget:\", error);\r\n    }\r\n  });\r\n});\r\n\r\n// =======================\r\n// Widget Factory\r\n// =======================\r\nclass BjPassWidgetFactory {\r\n  static create(config = {}) {\r\n    return new BjPassAuthWidget(config);\r\n  }\r\n\r\n  static createMultiple(configs) {\r\n    return configs.map((config) => new BjPassAuthWidget(config));\r\n  }\r\n\r\n  static createWithTheme(theme, config = {}) {\r\n    const themes = {\r\n      default: {\r\n        primaryColor: \"#0066cc\",\r\n        backgroundColor: \"#ffffff\",\r\n        borderColor: \"#ddd\",\r\n      },\r\n      dark: {\r\n        primaryColor: \"#4da6ff\",\r\n        backgroundColor: \"#2d2d2d\",\r\n        borderColor: \"#555\",\r\n        textColor: \"#ffffff\",\r\n      },\r\n      modern: {\r\n        primaryColor: \"#6366f1\",\r\n        backgroundColor: \"#fafafa\",\r\n        borderColor: \"#e5e7eb\",\r\n      },\r\n      minimal: {\r\n        primaryColor: \"#000000\",\r\n        backgroundColor: \"#ffffff\",\r\n        borderColor: \"transparent\",\r\n      },\r\n    };\r\n\r\n    const themeConfig = themes[theme] || themes.default;\r\n    return new BjPassAuthWidget({\r\n      ...config,\r\n      ui: {\r\n        ...config.ui,\r\n        theme,\r\n        ...themeConfig,\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\n// =======================\r\n// Plugin System\r\n// =======================\r\nclass PluginManager {\r\n  constructor(widget) {\r\n    this.widget = widget;\r\n    this.plugins = new Map();\r\n    this.hooks = new Map();\r\n  }\r\n\r\n  register(name, plugin) {\r\n    if (typeof plugin.init === \"function\") {\r\n      this.plugins.set(name, plugin);\r\n      plugin.init(this.widget);\r\n    }\r\n  }\r\n\r\n  unregister(name) {\r\n    const plugin = this.plugins.get(name);\r\n    if (plugin && typeof plugin.destroy === \"function\") {\r\n      plugin.destroy();\r\n    }\r\n    this.plugins.delete(name);\r\n  }\r\n\r\n  addHook(hookName, callback) {\r\n    if (!this.hooks.has(hookName)) {\r\n      this.hooks.set(hookName, []);\r\n    }\r\n    this.hooks.get(hookName).push(callback);\r\n  }\r\n\r\n  executeHook(hookName, ...args) {\r\n    const callbacks = this.hooks.get(hookName) || [];\r\n    callbacks.forEach((callback) => {\r\n      try {\r\n        callback(...args);\r\n      } catch (error) {\r\n        console.error(`Hook ${hookName} error:`, error);\r\n      }\r\n    });\r\n  }\r\n\r\n  getPlugin(name) {\r\n    return this.plugins.get(name);\r\n  }\r\n\r\n  listPlugins() {\r\n    return Array.from(this.plugins.keys());\r\n  }\r\n}\r\n\r\n// =======================\r\n// Built-in Plugins\r\n// =======================\r\n\r\n// Analytics Plugin\r\nclass AnalyticsPlugin {\r\n  init(widget) {\r\n    this.widget = widget;\r\n    this.setupAnalytics();\r\n  }\r\n\r\n  setupAnalytics() {\r\n    const originalStartAuth = this.widget.startAuthFlow.bind(this.widget);\r\n    const originalHandleSuccess = this.widget.exchangeCodeForTokens.bind(\r\n      this.widget\r\n    );\r\n    // const originalHandleError = this.widget.handleError.bind(this.widget);\r\n\r\n    this.widget.startAuthFlow = async () => {\r\n      this.track(\"auth_started\");\r\n      return originalStartAuth();\r\n    };\r\n\r\n    this.widget.exchangeCodeForTokens = async (code, state) => {\r\n      try {\r\n        const result = await originalHandleSuccess(code, state);\r\n        this.track(\"auth_success\");\r\n        return result;\r\n      } catch (error) {\r\n        this.track(\"auth_error\", { error: error.message });\r\n        throw error;\r\n      }\r\n    };\r\n  }\r\n\r\n  track(event, data = {}) {\r\n    console.log(\"Analytics:\", event, data);\r\n\r\n    // Send to analytics service\r\n    if (typeof gtag !== \"undefined\") {\r\n      //   gtag('event', event, {\r\n      //     event_category: 'bjpass_auth',\r\n      //     ...data\r\n      //   });\r\n    }\r\n\r\n    if (typeof window.analytics !== \"undefined\") {\r\n      window.analytics.track(event, data);\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    // Cleanup if needed\r\n  }\r\n}\r\n\r\n// Debug Plugin\r\nclass DebugPlugin {\r\n  init(widget) {\r\n    this.widget = widget;\r\n    this.originalConsoleLog = console.log;\r\n    this.setupDebugMode();\r\n  }\r\n\r\n  setupDebugMode() {\r\n    if (this.widget.getConfig().debug) {\r\n      this.addDebugPanel();\r\n      this.interceptMethods();\r\n    }\r\n  }\r\n\r\n  addDebugPanel() {\r\n    const debugPanel = document.createElement(\"div\");\r\n    debugPanel.id = \"bjpass-debug-panel\";\r\n    debugPanel.style.cssText = `\r\n      position: fixed;\r\n      top: 10px;\r\n      right: 10px;\r\n      width: 300px;\r\n      max-height: 400px;\r\n      background: rgba(0,0,0,0.9);\r\n      color: #00ff00;\r\n      font-family: monospace;\r\n      font-size: 12px;\r\n      padding: 10px;\r\n      border-radius: 5px;\r\n      overflow-y: auto;\r\n      z-index: 10000;\r\n      display: none;\r\n    `;\r\n\r\n    const header = document.createElement(\"div\");\r\n    header.innerHTML = `\r\n      <strong>BjPass Debug Panel</strong>\r\n      <button onclick=\"this.parentElement.parentElement.style.display='none'\" \r\n              style=\"float:right;background:none;border:none;color:#fff;cursor:pointer;\">×</button>\r\n    `;\r\n\r\n    const logs = document.createElement(\"div\");\r\n    logs.id = \"bjpass-debug-logs\";\r\n\r\n    debugPanel.appendChild(header);\r\n    debugPanel.appendChild(logs);\r\n    document.body.appendChild(debugPanel);\r\n\r\n    // Toggle button\r\n    const toggleBtn = document.createElement(\"button\");\r\n    toggleBtn.textContent = \"🐛\";\r\n    toggleBtn.style.cssText = `\r\n      position: fixed;\r\n      top: 10px;\r\n      right: 10px;\r\n      z-index: 10001;\r\n      background: #000;\r\n      color: #0f0;\r\n      border: none;\r\n      padding: 5px 10px;\r\n      border-radius: 3px;\r\n      cursor: pointer;\r\n    `;\r\n    toggleBtn.onclick = () => {\r\n      debugPanel.style.display =\r\n        debugPanel.style.display === \"none\" ? \"block\" : \"none\";\r\n    };\r\n    document.body.appendChild(toggleBtn);\r\n\r\n    this.debugPanel = debugPanel;\r\n    this.debugLogs = logs;\r\n  }\r\n\r\n  interceptMethods() {\r\n    const methods = [\r\n      \"startAuthFlow\",\r\n      \"handlePopupResponse\",\r\n      \"exchangeCodeForTokens\",\r\n      \"handleError\",\r\n    ];\r\n\r\n    methods.forEach((methodName) => {\r\n      const originalMethod = this.widget[methodName].bind(this.widget);\r\n      this.widget[methodName] = (...args) => {\r\n        this.log(`${methodName} called with:`, args);\r\n        const result = originalMethod(...args);\r\n        if (result instanceof Promise) {\r\n          return result\r\n            .then((res) => {\r\n              this.log(`${methodName} resolved:`, res);\r\n              return res;\r\n            })\r\n            .catch((err) => {\r\n              this.log(`${methodName} rejected:`, err);\r\n              throw err;\r\n            });\r\n        }\r\n        this.log(`${methodName} returned:`, result);\r\n        return result;\r\n      };\r\n    });\r\n  }\r\n\r\n  log(message, data) {\r\n    const timestamp = new Date().toLocaleTimeString();\r\n    const logEntry = document.createElement(\"div\");\r\n    logEntry.style.marginBottom = \"5px\";\r\n    logEntry.innerHTML = `\r\n      <span style=\"color:#888\">[${timestamp}]</span> \r\n      ${message} \r\n      ${data ? `<pre style=\"margin:5px 0;color:#ff0;\">${JSON.stringify(data, null, 2)}</pre>` : \"\"}\r\n    `;\r\n\r\n    if (this.debugLogs) {\r\n      this.debugLogs.appendChild(logEntry);\r\n      this.debugLogs.scrollTop = this.debugLogs.scrollHeight;\r\n    }\r\n\r\n    console.log(`[BjPass Debug] ${message}`, data);\r\n  }\r\n\r\n  destroy() {\r\n    if (this.debugPanel) {\r\n      document.body.removeChild(this.debugPanel);\r\n    }\r\n  }\r\n}\r\n\r\n// Retry Plugin\r\nclass RetryPlugin {\r\n  init(widget) {\r\n    this.widget = widget;\r\n    this.maxRetries = widget.getConfig().maxRetries || 3;\r\n    this.retryDelay = widget.getConfig().retryDelay || 1000;\r\n    this.setupRetryLogic();\r\n  }\r\n\r\n  setupRetryLogic() {\r\n    const originalExchangeCode = this.widget.exchangeCodeForTokens.bind(\r\n      this.widget\r\n    );\r\n\r\n    this.widget.exchangeCodeForTokens = async (code, state, attempt = 1) => {\r\n      try {\r\n        return await originalExchangeCode(code, state);\r\n      } catch (error) {\r\n        if (attempt < this.maxRetries && this.shouldRetry(error)) {\r\n          console.log(\r\n            `Retry attempt ${attempt}/${this.maxRetries} after ${this.retryDelay}ms`\r\n          );\r\n          await this.delay(this.retryDelay * attempt);\r\n          return this.widget.exchangeCodeForTokens(code, state, attempt + 1);\r\n        }\r\n        throw error;\r\n      }\r\n    };\r\n  }\r\n\r\n  shouldRetry(error) {\r\n    const retryableErrors = [\r\n      \"network\",\r\n      \"timeout\",\r\n      \"server_error\",\r\n      \"503\",\r\n      \"502\",\r\n      \"500\",\r\n    ];\r\n    return retryableErrors.some(\r\n      (errType) =>\r\n        error.message.toLowerCase().includes(errType) || error.code === errType\r\n    );\r\n  }\r\n\r\n  delay(ms) {\r\n    return new Promise((resolve) => setTimeout(resolve, ms));\r\n  }\r\n\r\n  destroy() {\r\n    // Cleanup if needed\r\n  }\r\n}\r\n\r\n// Enhanced Widget with Plugin Support\r\nclass EnhancedBjPassAuthWidget extends BjPassAuthWidget {\r\n  constructor(config = {}) {\r\n    super(config);\r\n    this.pluginManager = new PluginManager(this);\r\n    this.setupBuiltinPlugins();\r\n  }\r\n\r\n  setupBuiltinPlugins() {\r\n    const config = this.getConfig();\r\n\r\n    // Auto-enable plugins based on config\r\n    if (config.analytics) {\r\n      this.pluginManager.register(\"analytics\", new AnalyticsPlugin());\r\n    }\r\n\r\n    if (config.debug) {\r\n      this.pluginManager.register(\"debug\", new DebugPlugin());\r\n    }\r\n\r\n    if (config.maxRetries > 0) {\r\n      this.pluginManager.register(\"retry\", new RetryPlugin());\r\n    }\r\n  }\r\n\r\n  // Plugin API\r\n  use(name, plugin) {\r\n    this.pluginManager.register(name, plugin);\r\n    return this;\r\n  }\r\n\r\n  unuse(name) {\r\n    this.pluginManager.unregister(name);\r\n    return this;\r\n  }\r\n\r\n  getPlugin(name) {\r\n    return this.pluginManager.getPlugin(name);\r\n  }\r\n\r\n  // Hook API\r\n  addHook(hookName, callback) {\r\n    this.pluginManager.addHook(hookName, callback);\r\n    return this;\r\n  }\r\n\r\n  executeHook(hookName, ...args) {\r\n    this.pluginManager.executeHook(hookName, ...args);\r\n  }\r\n\r\n  // Enhanced methods with hooks\r\n  async startAuthFlow() {\r\n    this.executeHook(\"beforeAuthStart\");\r\n    try {\r\n      const result = await super.startAuthFlow();\r\n      this.executeHook(\"afterAuthStart\", result);\r\n      return result;\r\n    } catch (error) {\r\n      this.executeHook(\"authStartError\", error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async exchangeCodeForTokens(code, state) {\r\n    this.executeHook(\"beforeTokenExchange\", code, state);\r\n    try {\r\n      const result = await super.exchangeCodeForTokens(code, state);\r\n      this.executeHook(\"afterTokenExchange\", result);\r\n      return result;\r\n    } catch (error) {\r\n      this.executeHook(\"tokenExchangeError\", error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.executeHook(\"beforeDestroy\");\r\n    this.pluginManager.listPlugins().forEach((name) => {\r\n      this.pluginManager.unregister(name);\r\n    });\r\n    super.destroy();\r\n    this.executeHook(\"afterDestroy\");\r\n  }\r\n}\r\n\r\n// =======================\r\n// Exports and Global Setup\r\n// =======================\r\nif (typeof window !== \"undefined\") {\r\n  // Main exports\r\n  window.BjPassAuthWidget = BjPassAuthWidget;\r\n  window.EnhancedBjPassAuthWidget = EnhancedBjPassAuthWidget;\r\n  window.BjPassWidgetFactory = BjPassWidgetFactory;\r\n\r\n  // Component exports\r\n  window.BjPassComponents = {\r\n    ConfigManager,\r\n    CryptoUtils,\r\n    SessionManager,\r\n    UIManager,\r\n    TokenValidator,\r\n    BackendClient,\r\n    PopupManager,\r\n    ErrorHandler,\r\n    PluginManager,\r\n  };\r\n\r\n  // Plugin exports\r\n  window.BjPassPlugins = {\r\n    AnalyticsPlugin,\r\n    DebugPlugin,\r\n    RetryPlugin,\r\n  };\r\n\r\n  // Utility function for quick setup\r\n  window.createBjPassWidget = (config) => {\r\n    return BjPassWidgetFactory.create(config);\r\n  };\r\n}\r\n\r\n// Export par défaut pour ES modules et UMD\r\nif (typeof module !== \"undefined\" && module.exports) {\r\n  module.exports = BjPassAuthWidget;\r\n} else if (typeof define === \"function\" && define.amd) {\r\n  define(() => BjPassAuthWidget);\r\n} else if (typeof exports !== \"undefined\") {\r\n  exports.BjPassAuthWidget = BjPassAuthWidget;\r\n}\r\n\r\n// Export par défaut pour ES modules\r\nexport default BjPassAuthWidget;\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","__webpack_require__.amdO = {};","__webpack_require__.hmd = (module) => {\n\tmodule = Object.create(module);\n\tif (!module.children) module.children = [];\n\tObject.defineProperty(module, 'exports', {\n\t\tenumerable: true,\n\t\tset: () => {\n\t\t\tthrow new Error('ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: ' + module.id);\n\t\t}\n\t});\n\treturn module;\n};","","import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { BjPassAuthWidget, BjPassConfig, AuthResult, UserInfo, TokenInfo } from '../types';\r\n\r\nexport interface BjPassWidgetProps {\r\n  config: BjPassConfig;\r\n  onAuthSuccess?: (result: AuthResult) => void;\r\n  onAuthError?: (error: string) => void;\r\n  onUserInfo?: (user: UserInfo) => void;\r\n  onLogout?: () => void;\r\n  onTokensRefresh?: (tokens: TokenInfo) => void;\r\n  children?: React.ReactNode;\r\n  className?: string;\r\n  style?: React.CSSProperties;\r\n}\r\n\r\nexport interface BjPassWidgetRef {\r\n  widget: BjPassAuthWidget | null;\r\n  startAuth: () => Promise<AuthResult>;\r\n  logout: () => Promise<void>;\r\n  getUserInfo: () => Promise<UserInfo | null>;\r\n  isAuthenticated: () => boolean;\r\n  getTokens: () => TokenInfo | null;\r\n  refreshTokens: () => Promise<TokenInfo | null>;\r\n}\r\n\r\nexport const BjPassWidget: React.ForwardRefExoticComponent<\r\n  BjPassWidgetProps & React.RefAttributes<BjPassWidgetRef>\r\n> = React.forwardRef<BjPassWidgetRef, BjPassWidgetProps>(\r\n  ({ config, onAuthSuccess, onAuthError, onUserInfo, onLogout, onTokensRefresh, children, className, style }, ref) => {\r\n    const [isInitialized, setIsInitialized] = useState(false);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const widgetRef = useRef<BjPassAuthWidget | null>(null);\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n    // Initialize widget\r\n    useEffect(() => {\r\n      const initWidget = async () => {\r\n        try {\r\n          if (typeof window !== 'undefined' && window.BjPassAuthWidget) {\r\n            const widget = new window.BjPassAuthWidget(config);\r\n            widgetRef.current = widget;\r\n            \r\n            // Add event listeners\r\n            widget.addHook('afterAuthStart', (result: AuthResult) => {\r\n              if (result.success && onAuthSuccess) {\r\n                onAuthSuccess(result);\r\n              } else if (!result.success && onAuthError) {\r\n                onAuthError(result.error || 'Authentication failed');\r\n              }\r\n            });\r\n\r\n            widget.addHook('afterTokenExchange', (tokens: TokenInfo) => {\r\n              if (onTokensRefresh) {\r\n                onTokensRefresh(tokens);\r\n              }\r\n            });\r\n\r\n            setIsInitialized(true);\r\n          } else {\r\n            setError('BjPassAuthWidget not available');\r\n          }\r\n        } catch (err) {\r\n          setError(err instanceof Error ? err.message : 'Failed to initialize widget');\r\n        }\r\n      };\r\n\r\n      initWidget();\r\n    }, [config, onAuthSuccess, onAuthError, onTokensRefresh]);\r\n\r\n    // Render widget when initialized\r\n    useEffect(() => {\r\n      if (isInitialized && widgetRef.current && containerRef.current) {\r\n        try {\r\n          widgetRef.current.render(containerRef.current.id);\r\n        } catch (err) {\r\n          setError(err instanceof Error ? err.message : 'Failed to render widget');\r\n        }\r\n      }\r\n    }, [isInitialized]);\r\n\r\n    // Expose methods via ref\r\n    React.useImperativeHandle(ref, () => ({\r\n      widget: widgetRef.current,\r\n      startAuth: async () => {\r\n        if (!widgetRef.current) {\r\n          throw new Error('Widget not initialized');\r\n        }\r\n        setIsLoading(true);\r\n        setError(null);\r\n        try {\r\n          const result = await widgetRef.current.startAuthFlow();\r\n          return result;\r\n        } catch (err) {\r\n          const errorMsg = err instanceof Error ? err.message : 'Authentication failed';\r\n          setError(errorMsg);\r\n          throw err;\r\n        } finally {\r\n          setIsLoading(false);\r\n        }\r\n      },\r\n      logout: async () => {\r\n        if (!widgetRef.current) {\r\n          throw new Error('Widget not initialized');\r\n        }\r\n        try {\r\n          await widgetRef.current.logout();\r\n          if (onLogout) {\r\n            onLogout();\r\n          }\r\n        } catch (err) {\r\n          setError(err instanceof Error ? err.message : 'Logout failed');\r\n          throw err;\r\n        }\r\n      },\r\n      getUserInfo: async () => {\r\n        if (!widgetRef.current) {\r\n          return null;\r\n        }\r\n        try {\r\n          return await widgetRef.current.getUserInfo();\r\n        } catch (err) {\r\n          setError(err instanceof Error ? err.message : 'Failed to get user info');\r\n          return null;\r\n        }\r\n      },\r\n      isAuthenticated: () => {\r\n        return widgetRef.current?.isAuthenticated() || false;\r\n      },\r\n      getTokens: () => {\r\n        return widgetRef.current?.getTokens() || null;\r\n      },\r\n      refreshTokens: async () => {\r\n        if (!widgetRef.current) {\r\n          return null;\r\n        }\r\n        try {\r\n          return await widgetRef.current.refreshTokens();\r\n        } catch (err) {\r\n          setError(err instanceof Error ? err.message : 'Failed to refresh tokens');\r\n          return null;\r\n        }\r\n      },\r\n    }), [onLogout]);\r\n\r\n    // Cleanup on unmount\r\n    useEffect(() => {\r\n      return () => {\r\n        if (widgetRef.current) {\r\n          widgetRef.current.destroy();\r\n        }\r\n      };\r\n    }, []);\r\n\r\n    if (error) {\r\n      return (\r\n        <div className={`bjpass-error ${className || ''}`} style={style}>\r\n          <p>Error: {error}</p>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    if (!isInitialized) {\r\n      return (\r\n        <div className={`bjpass-loading ${className || ''}`} style={style}>\r\n          <p>Initializing authentication widget...</p>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className={`bjpass-widget-container ${className || ''}`} style={style}>\r\n        <div \r\n          ref={containerRef}\r\n          id=\"bjpass-auth-container\"\r\n          className=\"bjpass-auth-container\"\r\n        />\r\n        {children}\r\n        {isLoading && (\r\n          <div className=\"bjpass-loading-overlay\">\r\n            <p>Processing authentication...</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n);\r\n\r\nBjPassWidget.displayName = 'BjPassWidget';\r\n\r\n// Hook for easy usage\r\nexport const useBjPassAuth = (config: BjPassConfig) => {\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [user, setUser] = useState<UserInfo | null>(null);\r\n  const [tokens, setTokens] = useState<TokenInfo | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const widgetRef = useRef<BjPassWidgetRef>(null);\r\n\r\n  const startAuth = useCallback(async () => {\r\n    if (!widgetRef.current) return;\r\n    setIsLoading(true);\r\n    setError(null);\r\n    try {\r\n      const result = await widgetRef.current.startAuth();\r\n      if (result.success) {\r\n        setIsAuthenticated(true);\r\n        if (result.user) setUser(result.user);\r\n        if (result.tokens) setTokens(result.tokens);\r\n      }\r\n      return result;\r\n    } catch (err) {\r\n      const errorMsg = err instanceof Error ? err.message : 'Authentication failed';\r\n      setError(errorMsg);\r\n      throw err;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const logout = useCallback(async () => {\r\n    if (!widgetRef.current) return;\r\n    try {\r\n      await widgetRef.current.logout();\r\n      setIsAuthenticated(false);\r\n      setUser(null);\r\n      setTokens(null);\r\n    } catch (err) {\r\n      const errorMsg = err instanceof Error ? err.message : 'Logout failed';\r\n      setError(errorMsg);\r\n      throw err;\r\n    }\r\n  }, []);\r\n\r\n  const refreshUserInfo = useCallback(async () => {\r\n    if (!widgetRef.current) return;\r\n    try {\r\n      const userInfo = await widgetRef.current.getUserInfo();\r\n      if (userInfo) setUser(userInfo);\r\n      return userInfo;\r\n    } catch (err) {\r\n      const errorMsg = err instanceof Error ? err.message : 'Failed to get user info';\r\n      setError(errorMsg);\r\n      return null;\r\n    }\r\n  }, []);\r\n\r\n  const refreshTokens = useCallback(async () => {\r\n    if (!widgetRef.current) return;\r\n    try {\r\n      const newTokens = await widgetRef.current.refreshTokens();\r\n      if (newTokens) setTokens(newTokens);\r\n      return newTokens;\r\n    } catch (err) {\r\n      const errorMsg = err instanceof Error ? err.message : 'Failed to refresh tokens';\r\n      setError(errorMsg);\r\n      return null;\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    widgetRef,\r\n    isAuthenticated,\r\n    user,\r\n    tokens,\r\n    isLoading,\r\n    error,\r\n    startAuth,\r\n    logout,\r\n    refreshUserInfo,\r\n    refreshTokens,\r\n  };\r\n};\r\n","// Angular wrapper for BjPass Authentication Widget\r\n// This is a simplified wrapper that can be used with Angular\r\n\r\n// Simple EventEmitter implementation\r\nexport class SimpleEventEmitter<T> {\r\n  private listeners: ((value: T) => void)[] = [];\r\n\r\n  emit(value: T): void {\r\n    this.listeners.forEach(listener => listener(value));\r\n  }\r\n\r\n  subscribe(listener: (value: T) => void): { unsubscribe: () => void } {\r\n    this.listeners.push(listener);\r\n    return {\r\n      unsubscribe: () => {\r\n        const index = this.listeners.indexOf(listener);\r\n        if (index > -1) {\r\n          this.listeners.splice(index, 1);\r\n        }\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n// =======================\r\n// Angular Service\r\n// =======================\r\nexport class BjPassAuthService {\r\n  private widget: any = null;\r\n  private isInitialized = false;\r\n\r\n  // Events\r\n  public authSuccess$ = new SimpleEventEmitter<any>();\r\n  public authError$ = new SimpleEventEmitter<string>();\r\n  public userInfo$ = new SimpleEventEmitter<any>();\r\n  public logout$ = new SimpleEventEmitter<void>();\r\n  public tokensRefresh$ = new SimpleEventEmitter<any>();\r\n\r\n  constructor(private ngZone?: any) {}\r\n\r\n  /**\r\n   * Initialize the authentication widget\r\n   */\r\n  async initialize(config: any): Promise<void> {\r\n    if (this.isInitialized) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      if (typeof window !== 'undefined' && window.BjPassAuthWidget) {\r\n        this.widget = new window.BjPassAuthWidget(config);\r\n        \r\n        // Set up event listeners\r\n        this.widget.addHook('afterAuthStart', (result: any) => {\r\n          if (this.ngZone && this.ngZone.run) {\r\n            this.ngZone.run(() => {\r\n              if (result.success) {\r\n                this.authSuccess$.emit(result);\r\n              } else {\r\n                this.authError$.emit(result.error || 'Authentication failed');\r\n              }\r\n            });\r\n          } else {\r\n            if (result.success) {\r\n              this.authSuccess$.emit(result);\r\n            } else {\r\n              this.authError$.emit(result.error || 'Authentication failed');\r\n            }\r\n          }\r\n        });\r\n\r\n        this.widget.addHook('afterTokenExchange', (tokens: any) => {\r\n          if (this.ngZone && this.ngZone.run) {\r\n            this.ngZone.run(() => {\r\n              this.tokensRefresh$.emit(tokens);\r\n            });\r\n          } else {\r\n            this.tokensRefresh$.emit(tokens);\r\n          }\r\n        });\r\n\r\n        this.isInitialized = true;\r\n      } else {\r\n        throw new Error('BjPassAuthWidget not available');\r\n      }\r\n    } catch (error) {\r\n      throw new Error(`Failed to initialize widget: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start authentication flow\r\n   */\r\n  async startAuth(): Promise<any> {\r\n    if (!this.widget || !this.isInitialized) {\r\n      throw new Error('Widget not initialized. Call initialize() first.');\r\n    }\r\n    return await this.widget.startAuthFlow();\r\n  }\r\n\r\n  /**\r\n   * Exchange authorization code for tokens\r\n   */\r\n  async exchangeCodeForTokens(code: string, state: string): Promise<any> {\r\n    if (!this.widget || !this.isInitialized) {\r\n      throw new Error('Widget not initialized. Call initialize() first.');\r\n    }\r\n    return await this.widget.exchangeCodeForTokens(code, state);\r\n  }\r\n\r\n  /**\r\n   * Refresh tokens\r\n   */\r\n  async refreshTokens(): Promise<any> {\r\n    if (!this.widget || !this.isInitialized) {\r\n      throw new Error('Widget not initialized. Call initialize() first.');\r\n    }\r\n    return await this.widget.refreshTokens();\r\n  }\r\n\r\n  /**\r\n   * Logout user\r\n   */\r\n  async logout(): Promise<void> {\r\n    if (!this.widget || !this.isInitialized) {\r\n      throw new Error('Widget not initialized. Call initialize() first.');\r\n    }\r\n    await this.widget.logout();\r\n    if (this.ngZone && this.ngZone.run) {\r\n      this.ngZone.run(() => {\r\n        this.logout$.emit();\r\n      });\r\n    } else {\r\n      this.logout$.emit();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get user information\r\n   */\r\n  async getUserInfo(): Promise<any> {\r\n    if (!this.widget || !this.isInitialized) {\r\n      throw new Error('Widget not initialized. Call initialize() first.');\r\n    }\r\n    return await this.widget.getUserInfo();\r\n  }\r\n\r\n  /**\r\n   * Check if user is authenticated\r\n   */\r\n  isAuthenticated(): boolean {\r\n    if (!this.widget || !this.isInitialized) {\r\n      return false;\r\n    }\r\n    return this.widget.isAuthenticated();\r\n  }\r\n\r\n  /**\r\n   * Get current tokens\r\n   */\r\n  getTokens(): any {\r\n    if (!this.widget || !this.isInitialized) {\r\n      return null;\r\n    }\r\n    return this.widget.getTokens();\r\n  }\r\n\r\n  /**\r\n   * Get the widget instance\r\n   */\r\n  getWidget(): any {\r\n    return this.widget;\r\n  }\r\n\r\n  /**\r\n   * Clear tokens\r\n   */\r\n  clearTokens(): void {\r\n    if (this.widget && this.isInitialized) {\r\n      this.widget.clearTokens();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update configuration\r\n   */\r\n  updateConfig(newConfig: any): void {\r\n    if (this.widget && this.isInitialized) {\r\n      this.widget.updateConfig(newConfig);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current configuration\r\n   */\r\n  getConfig(): any {\r\n    if (this.widget && this.isInitialized) {\r\n      return this.widget.getConfig();\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Destroy widget\r\n   */\r\n  destroy(): void {\r\n    if (this.widget && this.isInitialized) {\r\n      this.widget.destroy();\r\n      this.widget = null;\r\n      this.isInitialized = false;\r\n    }\r\n  }\r\n}\r\n\r\n// =======================\r\n// Angular Component\r\n// =======================\r\nexport class BjPassWidgetComponent {\r\n  // Input properties\r\n  config: any;\r\n  containerClass = '';\r\n  containerStyle: any = {};\r\n  widgetClass = '';\r\n  loadingText = 'Initializing authentication widget...';\r\n  processingText = 'Processing authentication...';\r\n\r\n  // Output events\r\n  authSuccess = new SimpleEventEmitter<any>();\r\n  authError = new SimpleEventEmitter<string>();\r\n  userInfo = new SimpleEventEmitter<any>();\r\n  logoutEvent = new SimpleEventEmitter<void>();\r\n  tokensRefresh = new SimpleEventEmitter<any>();\r\n\r\n  // Internal state\r\n  isInitialized = false;\r\n  isLoading = false;\r\n  error: string | null = null;\r\n\r\n  constructor(\r\n    private authService: BjPassAuthService,\r\n    private elementRef?: any,\r\n    private ngZone?: any\r\n  ) {}\r\n\r\n  async ngOnInit(): Promise<void> {\r\n    try {\r\n      // Subscribe to service events\r\n      this.authService.authSuccess$.subscribe((result: any) => {\r\n        this.authSuccess.emit(result);\r\n      });\r\n\r\n      this.authService.authError$.subscribe((error: string) => {\r\n        this.authError.emit(error);\r\n      });\r\n\r\n      this.authService.userInfo$.subscribe((user: any) => {\r\n        this.userInfo.emit(user);\r\n      });\r\n\r\n      this.authService.logout$.subscribe(() => {\r\n        this.logoutEvent.emit();\r\n      });\r\n\r\n      this.authService.tokensRefresh$.subscribe((tokens: any) => {\r\n        this.tokensRefresh.emit(tokens);\r\n      });\r\n\r\n      // Initialize the widget\r\n      await this.authService.initialize(this.config);\r\n      this.isInitialized = true;\r\n\r\n      // Render the widget\r\n      this.renderWidget();\r\n    } catch (error) {\r\n      this.error = error instanceof Error ? error.message : 'Failed to initialize widget';\r\n    }\r\n  }\r\n\r\n  private renderWidget(): void {\r\n    if (this.isInitialized && this.authService.getWidget()) {\r\n      try {\r\n        const container = this.elementRef?.nativeElement?.querySelector('#bjpass-auth-container');\r\n        if (container) {\r\n          this.authService.getWidget()?.render(container);\r\n        }\r\n      } catch (error) {\r\n        this.error = error instanceof Error ? error.message : 'Failed to render widget';\r\n      }\r\n    }\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    // Cleanup is handled by the service\r\n  }\r\n\r\n  // Public methods that can be called from parent components\r\n  async startAuth(): Promise<any> {\r\n    this.isLoading = true;\r\n    this.error = null;\r\n    try {\r\n      const result = await this.authService.startAuth();\r\n      return result;\r\n    } catch (error) {\r\n      const errorMsg = error instanceof Error ? error.message : 'Authentication failed';\r\n      this.error = errorMsg;\r\n      throw error;\r\n    } finally {\r\n      this.isLoading = false;\r\n    }\r\n  }\r\n\r\n  async logout(): Promise<void> {\r\n    try {\r\n      await this.authService.logout();\r\n    } catch (error) {\r\n      this.error = error instanceof Error ? error.message : 'Logout failed';\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async getUserInfo(): Promise<any> {\r\n    try {\r\n      return await this.authService.getUserInfo();\r\n    } catch (error) {\r\n      this.error = error instanceof Error ? error.message : 'Failed to get user info';\r\n      return null;\r\n    }\r\n  }\r\n\r\n  isAuthenticated(): boolean {\r\n    return this.authService.isAuthenticated();\r\n  }\r\n\r\n  getTokens(): any {\r\n    return this.authService.getTokens();\r\n  }\r\n\r\n  async refreshTokens(): Promise<any> {\r\n    try {\r\n      return await this.authService.refreshTokens();\r\n    } catch (error) {\r\n      this.error = error instanceof Error ? error.message : 'Failed to refresh tokens';\r\n      return null;\r\n    }\r\n  }\r\n}\r\n\r\n// =======================\r\n// Angular Directive\r\n// =======================\r\nexport class BjPassAuthDirective {\r\n  // Input properties\r\n  bjPassConfig: any;\r\n  bjPassAutoInit = true;\r\n\r\n  // Output events\r\n  authSuccess = new SimpleEventEmitter<any>();\r\n  authError = new SimpleEventEmitter<string>();\r\n  userInfo = new SimpleEventEmitter<any>();\r\n  logoutEvent = new SimpleEventEmitter<void>();\r\n  tokensRefresh = new SimpleEventEmitter<any>();\r\n\r\n  private widget: any = null;\r\n  private isInitialized = false;\r\n\r\n  constructor(\r\n    private elementRef?: any,\r\n    private authService?: BjPassAuthService,\r\n    private ngZone?: any\r\n  ) {}\r\n\r\n  async ngOnInit(): Promise<void> {\r\n    if (this.bjPassAutoInit) {\r\n      await this.initialize();\r\n    }\r\n  }\r\n\r\n  async initialize(): Promise<void> {\r\n    try {\r\n      if (!this.authService) {\r\n        this.authService = new BjPassAuthService(this.ngZone);\r\n      }\r\n      \r\n      await this.authService.initialize(this.bjPassConfig);\r\n      this.isInitialized = true;\r\n\r\n      // Subscribe to events\r\n      this.authService.authSuccess$.subscribe((result: any) => {\r\n        if (this.ngZone && this.ngZone.run) {\r\n          this.ngZone.run(() => {\r\n            this.authSuccess.emit(result);\r\n          });\r\n        } else {\r\n          this.authSuccess.emit(result);\r\n        }\r\n      });\r\n\r\n      this.authService.authError$.subscribe((error: string) => {\r\n        if (this.ngZone && this.ngZone.run) {\r\n          this.ngZone.run(() => {\r\n            this.authError.emit(error);\r\n          });\r\n        } else {\r\n          this.authError.emit(error);\r\n        }\r\n      });\r\n\r\n      this.authService.userInfo$.subscribe((user: any) => {\r\n        if (this.ngZone && this.ngZone.run) {\r\n          this.ngZone.run(() => {\r\n            this.userInfo.emit(user);\r\n          });\r\n        } else {\r\n          this.userInfo.emit(user);\r\n        }\r\n      });\r\n\r\n      this.authService.logout$.subscribe(() => {\r\n        if (this.ngZone && this.ngZone.run) {\r\n          this.ngZone.run(() => {\r\n            this.logoutEvent.emit();\r\n          });\r\n        } else {\r\n          this.logoutEvent.emit();\r\n        }\r\n      });\r\n\r\n      this.authService.tokensRefresh$.subscribe((tokens: any) => {\r\n        if (this.ngZone && this.ngZone.run) {\r\n          this.ngZone.run(() => {\r\n            this.tokensRefresh.emit(tokens);\r\n          });\r\n        } else {\r\n          this.tokensRefresh.emit(tokens);\r\n        }\r\n      });\r\n\r\n      // Render widget in the directive element\r\n      this.renderWidget();\r\n    } catch (error) {\r\n      console.error('Failed to initialize BjPass directive:', error);\r\n    }\r\n  }\r\n\r\n  private renderWidget(): void {\r\n    if (this.isInitialized && this.authService) {\r\n      try {\r\n        this.authService.getWidget()?.render(this.elementRef?.nativeElement);\r\n      } catch (error) {\r\n        console.error('Failed to render widget in directive:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    // Cleanup is handled by the service\r\n  }\r\n\r\n  // Public methods\r\n  async startAuth(): Promise<any> {\r\n    if (!this.isInitialized || !this.authService) {\r\n      throw new Error('Directive not initialized');\r\n    }\r\n    return await this.authService.startAuth();\r\n  }\r\n\r\n  async logout(): Promise<void> {\r\n    if (!this.isInitialized || !this.authService) {\r\n      throw new Error('Directive not initialized');\r\n    }\r\n    await this.authService.logout();\r\n  }\r\n\r\n  isAuthenticated(): boolean {\r\n    return this.authService?.isAuthenticated() || false;\r\n  }\r\n\r\n  getTokens(): any {\r\n    return this.authService?.getTokens() || null;\r\n  }\r\n}\r\n\r\n// =======================\r\n// Angular Module\r\n// =======================\r\nexport class BjPassAuthModule {\r\n  static forRoot(): any {\r\n    return {\r\n      ngModule: BjPassAuthModule,\r\n      providers: [\r\n        BjPassAuthService\r\n      ]\r\n    };\r\n  }\r\n}\r\n","// Main exports\r\nexport { default as BjPassAuthWidget } from './bj-pass-auth-widget.js';\r\n\r\n// Types\r\nexport type {\r\n  BjPassConfig,\r\n  AuthResult,\r\n  UserInfo,\r\n  TokenInfo,\r\n  Plugin,\r\n  HookCallback,\r\n} from './types';\r\n\r\n// React components and hooks\r\nexport {\r\n  BjPassWidget,\r\n  useBjPassAuth,\r\n  type BjPassWidgetProps,\r\n  type BjPassWidgetRef,\r\n} from './wrappers/ReactWrapper';\r\n\r\n// Angular components, services and modules\r\nexport {\r\n  BjPassAuthService,\r\n  BjPassWidgetComponent,\r\n  BjPassAuthDirective,\r\n  BjPassAuthModule,\r\n} from './wrappers/AngularWrapper';\r\n"],"names":["ConfigManager","constructor","userConfig","environments","test","baseUrl","defaultAuthServer","production","defaultConfig","environment","clientId","authServer","scope","redirectUri","pkce","verifyAccessToken","tokenVerificationScopes","beUrl","beBearer","header","ui","showEnvSelector","container","language","primaryColor","theme","backendUrl","backendEndpoints","start","status","user","logout","refresh","frontendOrigin","backendOrigin","useBackend","popupMode","autoClosePopup","config","_objectSpread","resolvedConfig","applyEnvironmentConfig","env","envConfig","updateConfig","newConfig","get","getEnvironments","Object","keys","CryptoUtils","generateRandomString","length","array","Uint8Array","window","crypto","getRandomValues","Array","from","b","toString","padStart","join","generateCodeChallenge","codeVerifier","encoder","TextEncoder","data","encode","digest","subtle","btoa","String","fromCharCode","replace","base64UrlToArrayBuffer","base64Url","padding","repeat","base64","rawData","atob","output","i","charCodeAt","checkBrowserCompatibility","SessionManager","setItem","key","value","sessionStorage","getItem","removeItem","clear","forEach","generateAndStoreAuthData","state","nonce","includes","OAuthUrlBuilder","buildAuthorizationUrl","authData","codeChallenge","authUrl","URL","pathname","encodeURIComponent","params","URLSearchParams","response_type","client_id","redirect_uri","split","code_challenge","code_challenge_method","prompt","set","search","buildTokenUrl","buildJWKSUrl","buildIntrospectionUrl","TokenValidator","urlBuilder","validateIdToken","idToken","payload","decodedHeader","JSON","parse","decodedPayload","now","Math","floor","Date","savedNonce","exp","Error","aud","jwks","fetchJWKS","publicKey","find","kid","isValid","verifySignature","error","console","accessToken","response","fetch","method","headers","Authorization","body","token","json","ok","active","jwk","importKey","name","hash","signature","signatureData","verify","UIComponent","element","eventListeners","Map","createElement","tag","className","innerHTML","document","addEventListeners","events","entries","event","handler","addEventListener","has","push","removeEventListeners","listeners","removeEventListener","destroy","parentNode","removeChild","render","show","style","display","hide","EnvironmentSelector","onEnvironmentChange","envOptions","map","charAt","toUpperCase","slice","radioInputs","querySelectorAll","radio","change","e","target","appendChild","LoginButton","onLogin","type","cssText","click","mouseover","opacity","mouseout","setLoading","isLoading","disabled","LoadingSpinner","spinner","querySelector","getElementById","id","textContent","head","ErrorDisplay","showError","message","clearError","UIManager","components","initialize","createMainContainer","initializeComponents","mainElement","title","envSelector","bind","loginButton","onLoginClick","loadingSpinner","errorDisplay","helpText","onEnvironmentChangeCallback","onLoginCallback","setState","newState","updateUI","values","component","setOnEnvironmentChange","callback","setOnLogin","BackendClient","exchangeCode","code","stringify","code_verifier","errorData","exchangeCodeDirect","grant_type","error_description","handleBackendAuthResponse","handleBackendAuthSuccess","handleBackendAuthError","handleError","popupManager","close","uiManager","onSuccess","backendData","source","verifyBackendStatus","onError","statusUrl","credentials","Accept","statusData","authenticated","log","startBackendAuthFlow","startUrl","returnUrl","searchParams","open","getUserInfoFromBackend","userUrl","userData","logoutFromBackend","logoutUrl","PopupManager","popup","checkInterval","url","onClose","width","height","left","screen","top","setInterval","closed","clearInterval","isOpen","ErrorHandler","getErrorMessage","description","errorMessage","errorMessages","invalid_token","unsuported_grant_type_error","insufficient_scope","invalid_grant","access_denied","invalid_request","invalid_scope","server_error","popup_closed","browser_error","backend_error","token_error","token_exchange_error","BjPassAuthWidget","configManager","tokenValidator","backendClient","setupMessageListener","setupEventHandlers","startAuthFlow","isValidMessageOrigin","origin","warn","allowedOrigins","some","allowed","startDirectAuthFlow","handlePopupResponse","queryParams","savedState","exchangeCodeForTokens","tokenData","validateTokens","id_token","access_token","errorCode","getUserInfo","onLogout","refreshToken","refreshUrl","refreshData","token_info","getConfig","BjPassComponents","containers","dataset","bjpassWidget","BjPassWidgetFactory","create","createMultiple","configs","createWithTheme","themes","default","backgroundColor","borderColor","dark","textColor","modern","minimal","themeConfig","PluginManager","widget","plugins","hooks","register","plugin","init","unregister","delete","addHook","hookName","executeHook","args","callbacks","getPlugin","listPlugins","AnalyticsPlugin","setupAnalytics","_this","originalStartAuth","originalHandleSuccess","track","result","gtag","analytics","DebugPlugin","originalConsoleLog","setupDebugMode","debug","addDebugPanel","interceptMethods","debugPanel","logs","toggleBtn","onclick","debugLogs","methods","methodName","originalMethod","Promise","then","res","catch","err","timestamp","toLocaleTimeString","logEntry","marginBottom","scrollTop","scrollHeight","RetryPlugin","maxRetries","retryDelay","setupRetryLogic","_this2","originalExchangeCode","attempt","shouldRetry","delay","retryableErrors","errType","toLowerCase","ms","resolve","setTimeout","EnhancedBjPassAuthWidget","pluginManager","setupBuiltinPlugins","use","unuse","BjPassPlugins","createBjPassWidget","module","exports","define","amd","React","useEffect","useRef","useState","useCallback","BjPassWidget","forwardRef","onAuthSuccess","onAuthError","onUserInfo","onTokensRefresh","children","ref","isInitialized","setIsInitialized","setIsLoading","setError","widgetRef","containerRef","initWidget","current","success","tokens","useImperativeHandle","startAuth","errorMsg","isAuthenticated","_widgetRef$current","getTokens","_widgetRef$current2","refreshTokens","displayName","useBjPassAuth","setIsAuthenticated","setUser","setTokens","refreshUserInfo","userInfo","newTokens","SimpleEventEmitter","_defineProperty","emit","listener","subscribe","unsubscribe","index","indexOf","splice","BjPassAuthService","ngZone","run","authSuccess$","authError$","tokensRefresh$","logout$","getWidget","clearTokens","BjPassWidgetComponent","authService","elementRef","ngOnInit","authSuccess","authError","userInfo$","logoutEvent","tokensRefresh","renderWidget","_this$elementRef","nativeElement","_this$authService$get","ngOnDestroy","BjPassAuthDirective","bjPassAutoInit","bjPassConfig","_this$authService$get2","_this$elementRef2","_this$authService","_this$authService2","BjPassAuthModule","forRoot","ngModule","providers"],"sourceRoot":""}