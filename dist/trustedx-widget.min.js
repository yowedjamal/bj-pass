(()=>{var f=class{constructor(e={}){this.environments={test:{baseUrl:"https://test-tx-pki.gouv.bj",defaultAuthServer:"main-as"},production:{baseUrl:"https://tx-pki.gouv.bj",defaultAuthServer:"main-as"}},this.defaultConfig={environment:"test",clientId:"",authServer:"",scope:"openid profile",redirectUri:window.location.origin+"/examples/redirect.html",pkce:!0,verifyAccessToken:!1,tokenVerificationScopes:["urn:safelayer:eidas:oauth:token:introspect"],beUrl:"http://localhost:8000/api/v1/code-exchange",beBearer:"",ui:{showEnvSelector:!0,container:"#trustedx-auth-container",language:"fr",primaryColor:"#0066cc",theme:"default"}},this.config={...this.defaultConfig,...e},this.resolvedConfig=this.applyEnvironmentConfig()}applyEnvironmentConfig(){let e=this.config.environment||"test",t=this.environments[e]||this.environments.test;return{...this.config,baseUrl:t.baseUrl,authServer:this.config.authServer||t.defaultAuthServer}}updateConfig(e){this.config={...this.config,...e},this.resolvedConfig=this.applyEnvironmentConfig()}get(){return this.resolvedConfig}getEnvironments(){return Object.keys(this.environments)}},c=class{static generateRandomString(e){let t=new Uint8Array(e);return window.crypto.getRandomValues(t),Array.from(t,n=>n.toString(16).padStart(2,"0")).join("")}static async generateCodeChallenge(e){let n=new TextEncoder().encode(e),i=await window.crypto.subtle.digest("SHA-256",n);return btoa(String.fromCharCode(...new Uint8Array(i))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}static base64UrlToArrayBuffer(e){let t="=".repeat((4-e.length%4)%4),n=e.replace(/-/g,"+").replace(/_/g,"/")+t,i=atob(n),r=new Uint8Array(i.length);for(let s=0;s<i.length;++s)r[s]=i.charCodeAt(s);return r}static checkBrowserCompatibility(){return!!(window.crypto&&window.crypto.subtle)}},a=class{static setItem(e,t){sessionStorage.setItem(`tx_auth_${e}`,t)}static getItem(e){return sessionStorage.getItem(`tx_auth_${e}`)}static removeItem(e){sessionStorage.removeItem(`tx_auth_${e}`)}static clear(){["state","code_verifier","nonce","success"].forEach(t=>this.removeItem(t))}static generateAndStoreAuthData(e){let t=c.generateRandomString(32),n=c.generateRandomString(32),i=c.generateRandomString(64);return this.setItem("state",t),this.setItem("code_verifier",i),e.includes("openid")&&this.setItem("nonce",n),{state:t,nonce:n,codeVerifier:i}}},p=class{constructor(e){this.config=e}async buildAuthorizationUrl(e){let{state:t,nonce:n,codeVerifier:i}=e,r=await c.generateCodeChallenge(i),s=new URL(`${this.config.baseUrl}/trustedx-authserver/oauth`);this.config.authServer&&(s.pathname+=`/${encodeURIComponent(this.config.authServer)}`);let u=new URLSearchParams({response_type:"code",client_id:this.config.clientId,redirect_uri:this.config.redirectUri,scope:this.config.scope.split("+").join(" "),state:t,code_challenge:r,code_challenge_method:"S256",prompt:"login"});return this.config.scope.includes("openid")&&n&&u.set("nonce",n),s.search=u.toString(),s.toString()}buildTokenUrl(){return`${this.config.baseUrl}/trustedx-authserver/oauth/${encodeURIComponent(this.config.authServer)}/token`}buildJWKSUrl(){return`${this.config.baseUrl}/trustedx-authserver/oauth/keys`}buildIntrospectionUrl(){return`${this.config.baseUrl}/trustedx-authserver/oauth/token/verify`}},l=class{constructor(e,t){this.config=e,this.urlBuilder=t}async validateIdToken(e){try{let[t,n]=e.split("."),i=JSON.parse(atob(t)),r=JSON.parse(atob(n)),s=Math.floor(Date.now()/1e3),u=a.getItem("nonce");if(r.exp<s)throw new Error("Token expired");if(r.nonce!==u)throw new Error("Invalid nonce");if(r.aud!==this.config.clientId)throw new Error("Invalid audience");let A=(await this.fetchJWKS()).keys.find(I=>I.kid===i.kid);if(!A)throw new Error("No matching public key found");if(!await this.verifySignature(e,A))throw new Error("Invalid signature");return r}catch(t){throw console.error("ID Token validation failed:",t),new Error("Invalid ID Token")}}async verifyAccessToken(e){try{let t=await fetch(this.urlBuilder.buildIntrospectionUrl(),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Bearer ${e}`},body:new URLSearchParams({token:e})}),n=await t.json();if(!t.ok||!n.active)throw new Error("Token verification failed");return n}catch(t){throw console.error("Token verification error:",t),t}}async fetchJWKS(){let e=await fetch(this.urlBuilder.buildJWKSUrl());if(!e.ok)throw new Error("Failed to fetch JWKS");return await e.json()}async verifySignature(e,t){try{let n=await window.crypto.subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]),[i,r,s]=e.split("."),u=c.base64UrlToArrayBuffer(s),L=new TextEncoder().encode(`${i}.${r}`);return await window.crypto.subtle.verify("RSASSA-PKCS1-v1_5",n,u,L)}catch(n){return console.error("Signature verification error:",n),!1}}},g=class{constructor(e){this.container=e,this.element=null,this.eventListeners=new Map}createElement(e,t="",n=""){let i=document.createElement(e);return t&&(i.className=t),n&&(i.innerHTML=n),i}addEventListeners(e,t){Object.entries(t).forEach(([n,i])=>{e.addEventListener(n,i),this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push({event:n,handler:i})})}removeEventListeners(){this.eventListeners.forEach((e,t)=>{e.forEach(({event:n,handler:i})=>{t.removeEventListener(n,i)})}),this.eventListeners.clear()}destroy(){this.removeEventListeners(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}render(){throw new Error("render() must be implemented by subclass")}show(){this.element&&(this.element.style.display="block")}hide(){this.element&&(this.element.style.display="none")}},E=class extends g{constructor(e,t,n){super(e),this.config=t,this.onEnvironmentChange=n,this.render()}render(){if(!this.config.ui.showEnvSelector)return;let e=this.config.getEnvironments().map(n=>`
        <label>
          <input type="radio" name="env" value="${n}" ${n===this.config.get().environment?"checked":""}>
          ${n.charAt(0).toUpperCase()+n.slice(1)}
        </label>
      `).join("");this.element=this.createElement("div","trustedx-env-selector",`
      <div class="env-selector-label">Environment:</div>
      ${e}
    `),this.element.querySelectorAll('input[name="env"]').forEach(n=>{this.addEventListeners(n,{change:i=>this.onEnvironmentChange(i.target.value)})}),this.container.appendChild(this.element)}},S=class extends g{constructor(e,t,n){super(e),this.config=t,this.onLogin=n,this.render()}render(){this.element=this.createElement("button","trustedx-login-btn","Se connecter"),this.element.type="button",this.element.style.cssText=`
      width: 100%;
      padding: 12px 24px;
      background-color: ${this.config.ui.primaryColor};
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.2s;
    `,this.addEventListeners(this.element,{click:this.onLogin,mouseover:()=>{this.element.style.opacity="0.9"},mouseout:()=>{this.element.style.opacity="1"}}),this.container.appendChild(this.element)}setLoading(e){this.element.disabled=e,this.element.innerHTML=e?"Connexion...":"Se connecter"}},M=class extends g{constructor(e){super(e),this.render()}render(){this.element=this.createElement("div","trustedx-loading",`
      <div class="spinner"></div>
      <div class="loading-text">Authentification en cours...</div>
    `),this.element.style.cssText=`
      display: none;
      text-align: center;
      padding: 20px;
    `;let e=this.element.querySelector(".spinner");if(e.style.cssText=`
      border: 3px solid #f3f3f3;
      border-radius: 50%;
      border-top: 3px solid #0066cc;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    `,!document.getElementById("trustedx-spinner-styles")){let t=document.createElement("style");t.id="trustedx-spinner-styles",t.textContent=`
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `,document.head.appendChild(t)}this.container.appendChild(this.element)}},T=class extends g{constructor(e,t){super(e),this.config=t,this.render()}render(){this.element=this.createElement("div","trustedx-error"),this.element.style.cssText=`
      display: none;
      padding: 12px;
      margin: 10px 0;
      background-color: #fee;
      border: 1px solid #fcc;
      border-radius: 4px;
      color: #c33;
      font-size: 14px;
    `,this.container.appendChild(this.element)}showError(e){this.element.textContent=e,this.show()}clearError(){this.element.textContent="",this.hide()}},m=class{constructor(e){this.config=e,this.container=null,this.components={},this.state={isLoading:!1,error:null}}initialize(){if(this.container=document.querySelector(this.config.ui.container),!this.container)throw new Error(`Container ${this.config.ui.container} not found`);this.createMainContainer(),this.initializeComponents()}createMainContainer(){this.mainElement=document.createElement("div"),this.mainElement.className="trustedx-widget",this.mainElement.style.cssText=`
      max-width: 400px;
      margin: 0 auto;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    `;let e=document.createElement("h3");e.textContent="Authentification TrustedX",e.style.cssText=`
      color: ${this.config.ui.primaryColor};
      text-align: center;
      margin: 0 0 20px 0;
    `,this.mainElement.appendChild(e),this.container.appendChild(this.mainElement)}initializeComponents(){this.components.envSelector=new E(this.mainElement,this.config,this.onEnvironmentChange.bind(this)),this.components.loginButton=new S(this.mainElement,this.config,this.onLoginClick.bind(this)),this.components.loadingSpinner=new M(this.mainElement),this.components.errorDisplay=new T(this.mainElement,this.config);let e=document.createElement("p");e.textContent="Vous serez redirig\xE9 vers le service d'authentification s\xE9curis\xE9e",e.style.cssText=`
      text-align: center;
      margin: 15px 0 0 0;
      font-size: 0.9em;
      color: #666;
    `,this.mainElement.appendChild(e)}onEnvironmentChange(e){this.onEnvironmentChangeCallback&&this.onEnvironmentChangeCallback(e)}onLoginClick(){this.onLoginCallback&&this.onLoginCallback()}setState(e){this.state={...this.state,...e},this.updateUI()}updateUI(){this.state.isLoading?(this.components.loginButton.setLoading(!0),this.components.loadingSpinner.show(),this.components.errorDisplay.clearError()):(this.components.loginButton.setLoading(!1),this.components.loadingSpinner.hide(),this.state.error?this.components.errorDisplay.showError(this.state.error):this.components.errorDisplay.clearError())}destroy(){Object.values(this.components).forEach(e=>{e.destroy&&e.destroy()}),this.mainElement&&this.mainElement.parentNode&&this.mainElement.parentNode.removeChild(this.mainElement)}setOnEnvironmentChange(e){this.onEnvironmentChangeCallback=e}setOnLogin(e){this.onLoginCallback=e}},d=class{constructor(e){this.config=e}async exchangeCode(e,t){let n=await fetch(this.config.beUrl,{method:"POST",headers:{"Content-Type":"application/json",Authorization:this.config.beBearer,"x-tenant-id":"589l15lWQE"},body:JSON.stringify({code:e,state:t,redirect_uri:this.config.redirectUri,code_verifier:a.getItem("code_verifier")})});if(!n.ok){let i=await n.json();throw new Error(i.message||"\xC9chec de l'authentification")}return await n.json()}async exchangeCodeDirect(e,t,n){let i=a.getItem("code_verifier");if(!i)throw new Error("Missing code verifier");let r=await fetch(n.buildTokenUrl(),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",code:e,redirect_uri:this.config.redirectUri,client_id:this.config.clientId,code_verifier:i})}),s=await r.json();if(!r.ok)throw new Error(s.error_description||"Failed to obtain token");return s}},w=class{constructor(){this.popup=null,this.checkInterval=null}open(e,t){let r=(screen.width-500)/2,s=(screen.height-600)/2;this.popup=window.open(e,"TrustedXAuth",`width=${500},height=${600},top=${s},left=${r},resizable=yes,scrollbars=yes`),this.checkInterval=setInterval(()=>{this.popup&&this.popup.closed&&(this.close(),t&&t())},500)}close(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null),this.popup&&!this.popup.closed&&this.popup.close(),this.popup=null}isOpen(){return this.popup&&!this.popup.closed}},y=class{static getErrorMessage(e,t){let n="Erreur d'authentification",i={invalid_token:"Token invalide ou expir\xE9",insufficient_scope:"Permissions insuffisantes",invalid_grant:"Code d'autorisation invalide ou expir\xE9",access_denied:"Authentification annul\xE9e",invalid_request:"Requ\xEAte invalide",invalid_scope:"Permissions invalides",server_error:"Erreur du serveur",popup_closed:"La fen\xEAtre d'authentification a \xE9t\xE9 ferm\xE9e",browser_error:"Navigateur non support\xE9",backend_error:"Erreur du backend",token_error:"Erreur de validation du token"};return i[e]&&(n=i[e]),t&&(n+=`: ${t}`),n}},h=class{constructor(e={}){if(this.configManager=new f(e),this.uiManager=new m(this.configManager.get()),this.urlBuilder=new p(this.configManager.get()),this.tokenValidator=new l(this.configManager.get(),this.urlBuilder),this.backendClient=new d(this.configManager.get()),this.popupManager=new w,!c.checkBrowserCompatibility())throw new Error("Browser not supported. Please use a modern browser.");this.initialize(),this.setupMessageListener()}initialize(){this.uiManager.initialize(),this.setupEventHandlers()}setupEventHandlers(){this.uiManager.setOnEnvironmentChange(e=>{this.configManager.updateConfig({environment:e}),this.urlBuilder=new p(this.configManager.get()),this.tokenValidator=new l(this.configManager.get(),this.urlBuilder),this.backendClient=new d(this.configManager.get())}),this.uiManager.setOnLogin(()=>{this.startAuthFlow()})}setupMessageListener(){window.addEventListener("message",e=>{e.data.type==="trustedx-auth-response"&&this.handlePopupResponse(e.data.query)})}async startAuthFlow(){try{this.uiManager.setState({isLoading:!0,error:null});let e=this.configManager.get(),t=a.generateAndStoreAuthData(e.scope),n=await this.urlBuilder.buildAuthorizationUrl(t);console.log("Authorization URL:",n),this.popupManager.open(n,()=>{this.uiManager.setState({isLoading:!1}),a.getItem("success")||this.handleError("popup_closed","La fen\xEAtre d'authentification a \xE9t\xE9 ferm\xE9e")})}catch(e){this.handleError("auth_flow_error",e.message)}}async handlePopupResponse(e){try{let t=new URLSearchParams(e),n=t.get("code"),i=t.get("state"),r=t.get("error");if(r){this.handleError(r,t.get("error_description"));return}if(!n||!i){this.handleError("invalid_response","Code ou state manquant");return}let s=a.getItem("state");if(i!==s){this.handleError("invalid_state","Param\xE8tre state invalide");return}a.setItem("success","true"),this.popupManager.close(),await this.exchangeCodeForTokens(n,i)}catch(t){this.handleError("callback_error",t.message)}}async exchangeCodeForTokens(e,t){try{let n=this.configManager.get(),i;n.beUrl&&n.beBearer?i=await this.backendClient.exchangeCode(e,t):i=await this.backendClient.exchangeCodeDirect(e,t,this.urlBuilder),await this.validateTokens(i),a.clear(),this.uiManager.setState({isLoading:!1,error:null}),n.onSuccess&&n.onSuccess(i)}catch(n){this.handleError("token_exchange_error",n.message)}}async validateTokens(e){let t=this.configManager.get();e.id_token&&t.scope.includes("openid")&&await this.tokenValidator.validateIdToken(e.id_token),t.verifyAccessToken&&e.access_token&&await this.tokenValidator.verifyAccessToken(e.access_token)}handleError(e,t){console.error("Auth error:",e,t);let n=y.getErrorMessage(e,t);this.uiManager.setState({isLoading:!1,error:n});let i=this.configManager.get();i.onError&&i.onError({error:e,error_description:t})}destroy(){this.popupManager.close(),this.uiManager.destroy(),a.clear()}refresh(){this.uiManager.destroy(),this.initialize()}getConfig(){return this.configManager.get()}updateConfig(e){this.configManager.updateConfig(e),this.urlBuilder=new p(this.configManager.get()),this.tokenValidator=new l(this.configManager.get(),this.urlBuilder),this.backendClient=new d(this.configManager.get())}};typeof window<"u"&&(window.TrustedXAuthWidget=h,window.TrustedXComponents={ConfigManager:f,CryptoUtils:c,SessionManager:a,UIManager:m,TokenValidator:l,BackendClient:d,PopupManager:w,ErrorHandler:y});document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-trustedx-widget]").forEach(e=>{try{let t=e.dataset.trustedxWidget?JSON.parse(e.dataset.trustedxWidget):{};t.ui={...t.ui,container:`#${e.id}`},new h(t)}catch(t){console.error("Failed to initialize TrustedX widget:",t)}})});var v=class{static create(e={}){return new h(e)}static createMultiple(e){return e.map(t=>new h(t))}static createWithTheme(e,t={}){let n={default:{primaryColor:"#0066cc",backgroundColor:"#ffffff",borderColor:"#ddd"},dark:{primaryColor:"#4da6ff",backgroundColor:"#2d2d2d",borderColor:"#555",textColor:"#ffffff"},modern:{primaryColor:"#6366f1",backgroundColor:"#fafafa",borderColor:"#e5e7eb"},minimal:{primaryColor:"#000000",backgroundColor:"#ffffff",borderColor:"transparent"}},i=n[e]||n.default;return new h({...t,ui:{...t.ui,theme:e,...i}})}},b=class{constructor(e){this.widget=e,this.plugins=new Map,this.hooks=new Map}register(e,t){typeof t.init=="function"&&(this.plugins.set(e,t),t.init(this.widget))}unregister(e){let t=this.plugins.get(e);t&&typeof t.destroy=="function"&&t.destroy(),this.plugins.delete(e)}addHook(e,t){this.hooks.has(e)||this.hooks.set(e,[]),this.hooks.get(e).push(t)}executeHook(e,...t){(this.hooks.get(e)||[]).forEach(i=>{try{i(...t)}catch(r){console.error(`Hook ${e} error:`,r)}})}getPlugin(e){return this.plugins.get(e)}listPlugins(){return Array.from(this.plugins.keys())}},x=class{init(e){this.widget=e,this.setupAnalytics()}setupAnalytics(){let e=this.widget.startAuthFlow.bind(this.widget),t=this.widget.exchangeCodeForTokens.bind(this.widget);this.widget.startAuthFlow=async()=>(this.track("auth_started"),e()),this.widget.exchangeCodeForTokens=async(n,i)=>{try{let r=await t(n,i);return this.track("auth_success"),r}catch(r){throw this.track("auth_error",{error:r.message}),r}}}track(e,t={}){console.log("Analytics:",e,t),typeof window.analytics<"u"&&window.analytics.track(e,t)}destroy(){}},k=class{init(e){this.widget=e,this.originalConsoleLog=console.log,this.setupDebugMode()}setupDebugMode(){this.widget.getConfig().debug&&(this.addDebugPanel(),this.interceptMethods())}addDebugPanel(){let e=document.createElement("div");e.id="trustedx-debug-panel",e.style.cssText=`
      position: fixed;
      top: 10px;
      right: 10px;
      width: 300px;
      max-height: 400px;
      background: rgba(0,0,0,0.9);
      color: #00ff00;
      font-family: monospace;
      font-size: 12px;
      padding: 10px;
      border-radius: 5px;
      overflow-y: auto;
      z-index: 10000;
      display: none;
    `;let t=document.createElement("div");t.innerHTML=`
      <strong>TrustedX Debug Panel</strong>
      <button onclick="this.parentElement.parentElement.style.display='none'" 
              style="float:right;background:none;border:none;color:#fff;cursor:pointer;">\xD7</button>
    `;let n=document.createElement("div");n.id="trustedx-debug-logs",e.appendChild(t),e.appendChild(n),document.body.appendChild(e);let i=document.createElement("button");i.textContent="\u{1F41B}",i.style.cssText=`
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 10001;
      background: #000;
      color: #0f0;
      border: none;
      padding: 5px 10px;
      border-radius: 3px;
      cursor: pointer;
    `,i.onclick=()=>{e.style.display=e.style.display==="none"?"block":"none"},document.body.appendChild(i),this.debugPanel=e,this.debugLogs=n}interceptMethods(){["startAuthFlow","handlePopupResponse","exchangeCodeForTokens","handleError"].forEach(t=>{let n=this.widget[t].bind(this.widget);this.widget[t]=(...i)=>{this.log(`${t} called with:`,i);let r=n(...i);return r instanceof Promise?r.then(s=>(this.log(`${t} resolved:`,s),s)).catch(s=>{throw this.log(`${t} rejected:`,s),s}):(this.log(`${t} returned:`,r),r)}})}log(e,t){let n=new Date().toLocaleTimeString(),i=document.createElement("div");i.style.marginBottom="5px",i.innerHTML=`
      <span style="color:#888">[${n}]</span> 
      ${e} 
      ${t?`<pre style="margin:5px 0;color:#ff0;">${JSON.stringify(t,null,2)}</pre>`:""}
    `,this.debugLogs&&(this.debugLogs.appendChild(i),this.debugLogs.scrollTop=this.debugLogs.scrollHeight),console.log(`[TrustedX Debug] ${e}`,t)}destroy(){this.debugPanel&&document.body.removeChild(this.debugPanel)}},C=class{init(e){this.widget=e,this.maxRetries=e.getConfig().maxRetries||3,this.retryDelay=e.getConfig().retryDelay||1e3,this.setupRetryLogic()}setupRetryLogic(){let e=this.widget.exchangeCodeForTokens.bind(this.widget);this.widget.exchangeCodeForTokens=async(t,n,i=1)=>{try{return await e(t,n)}catch(r){if(i<this.maxRetries&&this.shouldRetry(r))return console.log(`Retry attempt ${i}/${this.maxRetries} after ${this.retryDelay}ms`),await this.delay(this.retryDelay*i),this.widget.exchangeCodeForTokens(t,n,i+1);throw r}}}shouldRetry(e){return["network","timeout","server_error","503","502","500"].some(n=>e.message.toLowerCase().includes(n)||e.code===n)}delay(e){return new Promise(t=>setTimeout(t,e))}destroy(){}},_=class extends h{constructor(e={}){super(e),this.pluginManager=new b(this),this.setupBuiltinPlugins()}setupBuiltinPlugins(){let e=this.getConfig();e.analytics&&this.pluginManager.register("analytics",new x),e.debug&&this.pluginManager.register("debug",new k),e.maxRetries>0&&this.pluginManager.register("retry",new C)}use(e,t){return this.pluginManager.register(e,t),this}unuse(e){return this.pluginManager.unregister(e),this}getPlugin(e){return this.pluginManager.getPlugin(e)}addHook(e,t){return this.pluginManager.addHook(e,t),this}executeHook(e,...t){this.pluginManager.executeHook(e,...t)}async startAuthFlow(){this.executeHook("beforeAuthStart");try{let e=await super.startAuthFlow();return this.executeHook("afterAuthStart",e),e}catch(e){throw this.executeHook("authStartError",e),e}}async exchangeCodeForTokens(e,t){this.executeHook("beforeTokenExchange",e,t);try{let n=await super.exchangeCodeForTokens(e,t);return this.executeHook("afterTokenExchange",n),n}catch(n){throw this.executeHook("tokenExchangeError",n),n}}destroy(){this.executeHook("beforeDestroy"),this.pluginManager.listPlugins().forEach(e=>{this.pluginManager.unregister(e)}),super.destroy(),this.executeHook("afterDestroy")}};typeof window<"u"&&(window.TrustedXAuthWidget=h,window.EnhancedTrustedXAuthWidget=_,window.TrustedXWidgetFactory=v,window.TrustedXComponents={ConfigManager:f,CryptoUtils:c,SessionManager:a,UIManager:m,TokenValidator:l,BackendClient:d,PopupManager:w,ErrorHandler:y,PluginManager:b},window.TrustedXPlugins={AnalyticsPlugin:x,DebugPlugin:k,RetryPlugin:C},window.createTrustedXWidget=o=>v.create(o));})();
